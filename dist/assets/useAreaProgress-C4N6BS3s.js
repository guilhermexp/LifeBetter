import{r as e,aK as r,aN as t,aL as a,H as s}from"./vendor-react-Bu_1CUKu.js";import{q as o,s as i}from"./index-QnHMPHoX.js";import{C as n}from"./vendor-date-fns-BCWkNTJO.js";const l={total:0,completed:0,pending:0,today:0,overdue:0};function d(){const[r,t]=e.useState([]),[a,s]=e.useState(l),[d,c]=e.useState(!1),[u,p]=e.useState(null),{toast:g}=o(),h=e.useCallback((async()=>{try{c(!0),p(null);const{data:{user:e}}=await i.auth.getUser();if(!e)throw s(l),t([]),new Error("Usuário não autenticado");const{data:r,error:a}=await i.from("tasks").select("*").eq("user_id",e.id);if(a)throw a;const o=r||[];t(o);const d=n(new Date,"yyyy-MM-dd"),u=o.length,g=o.filter((e=>e.completed&&e.scheduled_date===d)).length,h=o.filter((e=>!e.completed&&e.scheduled_date===d)).length,f=o.filter((e=>!e.completed&&e.scheduled_date&&e.scheduled_date<d)).length,m=o.filter((e=>!e.completed)).length;return s({total:u,completed:g,pending:m,today:h,overdue:f}),o}catch(e){return p("Não foi possível carregar suas tarefas."),g({variant:"destructive",title:"Erro",description:"Não foi possível carregar suas tarefas."}),s(l),t([]),[]}finally{c(!1)}}),[g]),f=e.useCallback((async(e,a)=>{try{const{error:o}=await i.from("tasks").update({completed:!a}).eq("id",e);if(o)throw o;const l=r.find((r=>r.id===e));(null==l?void 0:l.scheduled_date)===n(new Date,"yyyy-MM-dd")?s((e=>({...e,completed:a?e.completed-1:e.completed+1,today:a?e.today+1:e.today-1}))):(null==l?void 0:l.scheduled_date)<n(new Date,"yyyy-MM-dd")&&s((e=>({...e,overdue:a?e.overdue+1:e.overdue-1}))),t((r=>r.map((r=>r.id===e?{...r,completed:!a}:r)))),s((e=>({...e,pending:a?e.pending+1:e.pending-1})))}catch(o){g({variant:"destructive",title:"Erro",description:"Não foi possível atualizar a tarefa."})}}),[r,g]);return{allTasks:r||[],taskCounts:a||l,fetchTasks:h,toggleTaskCompletion:f,isLoading:d,setIsLoading:c,error:u}}function c(){const[n,l]=e.useState([{area:"Saúde & Bem-estar",areaType:"health",icon:r,color:"bg-red-500",gradient:"bg-gradient-to-r from-red-500 to-pink-500",progress:0,description:"Atividades físicas, alimentação, sono e bem-estar geral",questionnaireScore:0},{area:"Carreira & Finanças",areaType:"business",icon:t,color:"bg-blue-500",gradient:"bg-gradient-to-r from-blue-500 to-indigo-500",progress:0,description:"Desenvolvimento profissional, projetos e finanças pessoais",questionnaireScore:0},{area:"Crescimento Pessoal",areaType:"growth",icon:a,color:"bg-amber-500",gradient:"bg-gradient-to-r from-amber-500 to-yellow-500",progress:0,description:"Aprendizado, hobbies, crescimento e desenvolvimento pessoal",questionnaireScore:0},{area:"Relacionamentos",areaType:"relationships",icon:s,color:"bg-purple-500",gradient:"bg-gradient-to-r from-purple-500 to-pink-500",progress:0,description:"Amizades, família, relacionamentos e vida social",questionnaireScore:0}]),[d,c]=e.useState(!1),[u,p]=e.useState(null),{toast:g}=o(),h=e.useCallback((async()=>{try{c(!0),p(null);const{data:{user:e}}=await i.auth.getUser();if(!e)throw new Error("Usuário não autenticado");const{data:r,error:t}=await i.from("tasks").select("*").eq("user_id",e.id);if(t)throw t;const{data:a,error:s}=await i.from("user_questionnaire").select("*").eq("user_id",e.id).single();s&&s.code;const o=n.map((e=>{var t,s;const o=r?r.filter((r=>{const t=r.type||"";return(t.includes("health")?"health":t.includes("work")||t.includes("business")?"business":t.includes("growth")||t.includes("personal")?"growth":t.includes("relationship")||t.includes("social")?"relationships":null)===e.areaType})).length:0,i=r?r.filter((r=>{const t=r.type||"";return(t.includes("health")?"health":t.includes("work")||t.includes("business")?"business":t.includes("growth")||t.includes("personal")?"growth":t.includes("relationship")||t.includes("social")?"relationships":null)===e.areaType&&r.completed})).length:0,n=o>0?Math.round(i/o*100):0,l=(null==(s=null==(t=null==a?void 0:a.results)?void 0:t[e.areaType])?void 0:s.overall)||0;return{...e,progress:n,questionnaireScore:l}}));return l(o),o}catch(e){return p("Não foi possível carregar o progresso das áreas."),g({variant:"destructive",title:"Erro",description:"Não foi possível carregar o progresso das áreas."}),n}finally{c(!1)}}),[n,g]);return{areaProgress:n,setAreaProgress:l,fetchAreaProgress:h,isLoading:d,error:u}}export{d as a,c as u};

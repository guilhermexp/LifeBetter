import{r as e}from"./vendor-react-Bu_1CUKu.js";import{q as t,s as r}from"./index-QnHMPHoX.js";function o(){const[o,a]=e.useState([]),[s,i]=e.useState({mood_type:"happiness",intensity:5,note:null}),[n,u]=e.useState(!1),[d,c]=e.useState(null),[m,l]=e.useState([]),{toast:p}=t(),h=e.useCallback((async()=>{try{u(!0),c(null);const{data:{user:e}}=await r.auth.getUser();if(!e)throw new Error("Usuário não autenticado");const{data:t,error:o}=await r.from("mood_entries").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(10);if(o)throw o;if(!t||0===t.length)return a([]),[];const s=t.map((e=>({id:e.id,user_id:e.user_id,mood_type:e.mood_type,intensity:e.intensity,note:e.note,created_at:e.created_at,updated_at:e.updated_at})));return a(s),s.length>2&&g(s),s}catch(e){return c("Não foi possível carregar seu histórico de humor."),p({variant:"destructive",title:"Erro",description:"Não foi possível carregar seu histórico de humor."}),[]}finally{u(!1)}}),[p]),y=e.useCallback((async(e=[])=>{try{u(!0),c(null);const{data:{user:t}}=await r.auth.getUser();if(!t)throw new Error("Usuário não autenticado");if(!s.mood_type)throw new Error("Tipo de humor não selecionado");let o=s.note||"";e&&e.length>0&&(o+=`\nGatilhos: ${e.join(", ")}`);const n={user_id:t.id,mood_type:s.mood_type,intensity:s.intensity,note:o||null},{data:d,error:m}=await r.from("mood_entries").insert(n).select().single();if(m)throw m;const l={id:d.id,user_id:d.user_id,mood_type:d.mood_type,intensity:d.intensity,note:d.note,created_at:d.created_at,updated_at:d.updated_at};return a((e=>[l,...e])),i({mood_type:"happiness",intensity:5,note:null}),p({title:"Humor registrado",description:"Seu registro de humor foi salvo com sucesso."}),l}catch(t){return c("Não foi possível salvar seu registro de humor."),p({variant:"destructive",title:"Erro",description:"Não foi possível salvar seu registro de humor."}),null}finally{u(!1)}}),[s,p]),g=e=>{const t=[],r={anxiety:0,anger:0,fatigue:0,sadness:0,vigor:0,happiness:0};e.forEach((e=>{e.mood_type&&r[e.mood_type]++}));const o=Object.entries(r).sort(((e,t)=>t[1]-e[1]))[0][0];["anxiety","anger","fatigue","sadness"].includes(o)?t.push({type:"negative",text:`Seu humor mais frequente é ${_(o)}.`,recommendation:`Considere adicionar atividades que ajudem a reduzir ${_(o)} em sua rotina.`}):t.push({type:"positive",text:`Seu humor mais frequente é ${_(o)}.`,recommendation:"Continue com as atividades que promovem esse estado emocional positivo."}),t.push({type:"neutral",text:"Registrar seu humor regularmente ajuda a identificar padrões emocionais importantes.",recommendation:"Tente registrar seu humor pelo menos uma vez por dia para melhores resultados."}),l(t)},_=e=>{switch(e){case"anxiety":return"Ansiedade";case"anger":return"Raiva";case"fatigue":return"Cansaço";case"sadness":return"Tristeza";case"vigor":return"Vigor";case"happiness":return"Alegria";default:return""}};return{moodHistory:o,fetchMoodHistory:h,currentMood:s,setCurrentMood:i,saveMood:y,moodInsights:m,isLoading:n,error:d}}export{o as u};

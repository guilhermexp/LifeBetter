import{j as e,az as s,r as a,t,aA as i,G as r,am as n,L as o,aj as l,aB as c,W as d,aC as m,aD as u,an as p,aE as x,aF as h,aG as g,aH as f,B as y,N as j,X as v,aI as N,aJ as b,a8 as w,ar as T,aK as S,H as A,aL as C,aM as q,aN as I}from"./vendor-react-Bu_1CUKu.js";import{u as D,s as k,B as O,a as F,A as P,b as E,c as z,L as _,I as B,T as M,S as H,d as L,e as $,f as R,g as G,P as U,h as V,i as J,C as W,D as K,j as Q,k as X,l as Y,m as Z,n as ee,o as se,p as ae,q as te,r as ie,t as re,v as ne,w as oe,x as le,y as ce,z as de,E as me,F as ue,G as pe}from"./index-QnHMPHoX.js";import{T as xe}from"./ThemeToggle-CoAAn6C_.js";import{u as he,a as ge}from"./useAreaProgress-C4N6BS3s.js";import{u as fe}from"./useMoodTracking-B0ZLuTFo.js";import{D as ye}from"./DeleteAllTasksButton-CsD95Qj5.js";import{S as je}from"./separator-B-xoOM7X.js";import{C as ve,H as Ne,G as be}from"./vendor-date-fns-BCWkNTJO.js";import{C as we,a as Te,b as Se,c as Ae,T as Ce,d as qe,e as Ie,f as De,g as ke,h as Oe}from"./card-BnqYcvPQ.js";import{P as Fe,S as Pe}from"./skeleton-DzSR_xWs.js";import"./vendor-CaMlX_x-.js";import"./dropdown-menu-cf7j1Lwd.js";function Ee({userName:a}){const t=a.split(" ")[0];return e.jsxs("div",{className:"bg-gradient-to-r from-violet-500 to-purple-600 rounded-xl p-4 text-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h1",{className:"font-semibold text-lg",children:["Olá, ",t,"!"]}),e.jsx(s,{className:"h-4 w-4 text-white/80"})]}),e.jsx("p",{className:"text-sm text-white/90 mt-1",children:"Aqui está o resumo das suas atividades."})]})}const ze=a.memo((function({title:s,subtitle:o}){const[l,c]=a.useState("Usuário"),[d,m]=a.useState(null),[u,p]=a.useState(0),x=t();D();const h=a.useCallback((async()=>{var e,s;try{const{data:{user:a}}=await k.auth.getUser();if(a){const{data:t}=await k.from("profiles").select("username, full_name, avatar_url").eq("id",a.id).maybeSingle();t?(c(t.full_name||t.username||(null==(e=a.email)?void 0:e.split("@")[0])||"Usuário"),m(t.avatar_url)):c((null==(s=a.email)?void 0:s.split("@")[0])||"Usuário");const{data:i,error:r}=await k.from("tasks").select("*").eq("user_id",a.id).eq("completed",!1);r||p((null==i?void 0:i.length)||0)}}catch(a){}}),[]);a.useEffect((()=>{h()}),[h]);const g=a.useCallback((()=>{x("/settings")}),[x]),f=a.useCallback((()=>{var e;null==(e=document.getElementById("favorites-trigger"))||e.click()}),[]);return e.jsxs("header",{className:"fixed top-0 left-0 right-0 bg-white z-10 border-b border-gray-100 shadow-sm",children:[e.jsxs("div",{className:"w-full max-w-2xl mx-auto px-4 py-2 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(O,{variant:"ghost",size:"icon",className:"rounded-full overflow-hidden border border-gray-200 w-10 h-10 bg-white shadow-sm",onClick:()=>F().setIsOpen(!0),children:e.jsxs(P,{className:"w-9 h-9",children:[e.jsx(E,{src:d||void 0,alt:l}),e.jsx(z,{className:"bg-violet-100 text-violet-800",children:l.charAt(0).toUpperCase()})]})})}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(xe,{}),e.jsx(O,{variant:"ghost",size:"icon",className:"rounded-full w-9 h-9 bg-white shadow-sm",onClick:f,children:e.jsx(i,{className:"h-4 w-4 text-gray-700"})}),e.jsx(O,{variant:"ghost",size:"icon",className:"rounded-full w-9 h-9 bg-white shadow-sm",onClick:g,"data-testid":"settings-button",children:e.jsx(r,{className:"h-4 w-4 text-gray-700"})}),e.jsxs(O,{variant:"ghost",size:"icon",className:"rounded-full w-9 h-9 bg-white shadow-sm relative",children:[e.jsx(n,{className:"h-4 w-4 text-gray-700"}),u>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:u>9?"9+":u})]})]})]}),e.jsx("button",{id:"favorites-trigger",className:"hidden",onClick:()=>{const e=document.querySelectorAll("button")[1];e&&e.click()}})]})}));function _e({taskCounts:s}){return e.jsxs("div",{className:"rounded-xl overflow-hidden shadow-sm",children:[e.jsx("div",{className:"bg-gradient-to-r from-violet-500/10 to-purple-600/10 px-4 py-3 border-b border-violet-100",children:e.jsx("h2",{className:"text-sm font-medium text-violet-800",children:"Resumo de produtividade de hoje"})}),e.jsxs("div",{className:"grid grid-cols-3 bg-white",children:[e.jsx(o,{to:"/today",className:"block border-r border-gray-100",children:e.jsxs("div",{className:"p-3 h-full flex flex-col justify-between hover:bg-violet-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-violet-100 flex items-center justify-center",children:e.jsx(l,{className:"h-3.5 w-3.5 text-violet-600"})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Pendentes"})]}),e.jsxs("div",{className:"flex items-baseline",children:[e.jsx("span",{className:"text-lg font-semibold text-violet-700",children:s.today}),e.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"Tarefas"})]})]})}),e.jsx(o,{to:"/today",className:"block border-r border-gray-100",children:e.jsxs("div",{className:"p-3 h-full flex flex-col justify-between hover:bg-green-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(c,{className:"h-3.5 w-3.5 text-green-600"})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Concluídas"})]}),e.jsxs("div",{className:"flex items-baseline",children:[e.jsx("span",{className:"text-lg font-semibold text-green-600",children:s.completed}),e.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"Tarefas"})]})]})}),e.jsx(o,{to:"/planner",className:"block",children:e.jsxs("div",{className:"p-3 h-full flex flex-col justify-between hover:bg-amber-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-amber-100 flex items-center justify-center",children:e.jsx(d,{className:"h-3.5 w-3.5 text-amber-600"})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Atrasadas"})]}),e.jsxs("div",{className:"flex items-baseline",children:[e.jsx("span",{className:"text-lg font-semibold text-amber-600",children:s.overdue}),e.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"Tarefas"})]})]})})]})]})}function Be({setIsOpen:t,shuffleTips:i}){const[r,n]=a.useState(!1);return e.jsxs("button",{onClick:async()=>{if(n(!0),t&&t(!0),i)try{await i()}catch(e){}finally{n(!1)}else n(!1)},disabled:r,className:"w-full bg-gradient-to-r from-violet-500 to-purple-600 rounded-xl h-12 text-white flex items-center justify-between px-4 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-0.5 group",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r?e.jsx(m,{className:"h-4 w-4 text-white animate-spin"}):e.jsx(s,{className:"h-4 w-4 text-white"}),e.jsx("span",{className:"font-medium text-sm",children:"Insights e Sugestões"})]}),e.jsx(u,{className:"h-4 w-4 text-white/80 transition-transform duration-300 group-hover:translate-x-0.5"})]})}function Me({habit:s,onFormChange:t}){var i;const[r,n]=a.useState(s.title),[o,c]=a.useState(s.description),[d,m]=a.useState((null==(i=s.implementation)?void 0:i.recommendedFrequency)||"daily"),[u,p]=a.useState(new Date),[x,h]=a.useState("08:00"),[g,f]=a.useState(30),y=e=>{t({title:r,description:o,frequency:e||d,date:u,time:x,duration:g})};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(_,{htmlFor:"title",className:"text-sm",children:"Nome do hábito"}),e.jsx(B,{id:"title",value:r,onChange:e=>{n(e.target.value),y()},placeholder:"Nome do hábito",className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(_,{htmlFor:"description",className:"text-sm",children:"Descrição"}),e.jsx(M,{id:"description",value:o,onChange:e=>{c(e.target.value),y()},placeholder:"Descrição do hábito",rows:2,className:"text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(_,{htmlFor:"frequency",className:"text-sm",children:"Frequência"}),e.jsxs(H,{value:d,onValueChange:e=>{m(e),y(e)},children:[e.jsx(L,{className:"h-9",children:e.jsx($,{placeholder:"Frequência"})}),e.jsxs(R,{children:[e.jsx(G,{value:"daily",children:"Diário"}),e.jsx(G,{value:"weekly",children:"Semanal"}),e.jsx(G,{value:"monthly",children:"Mensal"})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(_,{htmlFor:"time",className:"text-sm",children:"Horário"}),e.jsx(B,{id:"time",type:"time",value:x,onChange:e=>{h(e.target.value),y()},className:"h-9"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(_,{className:"text-sm",children:"Data de início"}),e.jsxs(U,{children:[e.jsx(V,{asChild:!0,children:e.jsxs(O,{variant:"outline",className:"w-full justify-start text-left font-normal h-9 text-sm",children:[e.jsx(l,{className:"mr-2 h-3.5 w-3.5"}),ve(u,"dd/MM/yyyy")]})}),e.jsx(J,{className:"w-auto p-0 z-50",children:e.jsx(W,{mode:"single",selected:u,onSelect:e=>{e&&(p(e),y())},initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(_,{htmlFor:"duration",className:"text-sm",children:"Duração (min)"}),e.jsx(B,{id:"duration",type:"number",value:g,onChange:e=>{f(parseInt(e.target.value)||30),y()},min:5,max:240,className:"h-9"})]})]})]})}function He({plan:s,habit:a}){return e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-2 flex items-center",children:[e.jsx(l,{className:"h-4 w-4 text-indigo-600 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-700",children:"Frequência"}),e.jsx("p",{className:"font-medium",children:"daily"===s.frequency?"Diário":"weekly"===s.frequency?"Semanal":"monthly"===s.frequency?"Mensal":s.frequency})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-2 flex items-center",children:[e.jsx(p,{className:"h-4 w-4 text-green-600 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-700",children:"Melhor horário"}),e.jsx("p",{className:"font-medium",children:s.bestTime})]})]}),e.jsxs("div",{className:"bg-amber-50 rounded-lg p-2 flex items-center",children:[e.jsx(c,{className:"h-4 w-4 text-amber-600 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-700",children:"Duração"}),e.jsx("p",{className:"font-medium",children:s.suggestedDuration})]})]})]}),s.implementation&&e.jsxs("div",{className:"space-y-3",children:[s.implementation.progressionSteps&&e.jsxs("details",{children:[e.jsx("summary",{className:"font-medium text-gray-900 cursor-pointer",children:"Passos para Progressão"}),e.jsx("ul",{className:"list-disc pl-5 mt-1 space-y-0.5",children:s.implementation.progressionSteps.map(((s,a)=>e.jsx("li",{className:"text-gray-700",children:s},a)))})]}),s.implementation.adaptationTips&&e.jsxs("details",{children:[e.jsx("summary",{className:"font-medium text-gray-900 cursor-pointer",children:"Dicas de Adaptação"}),e.jsx("ul",{className:"list-disc pl-5 mt-1 space-y-0.5",children:s.implementation.adaptationTips.map(((s,a)=>e.jsx("li",{className:"text-gray-700",children:s},a)))})]}),s.implementation.scientificBasis&&e.jsxs("details",{children:[e.jsx("summary",{className:"font-medium text-gray-900 cursor-pointer",children:"Base Científica"}),e.jsx("p",{className:"text-gray-700 mt-1",children:s.implementation.scientificBasis})]}),a.study&&e.jsxs("details",{children:[e.jsx("summary",{className:"font-medium text-gray-900 cursor-pointer",children:"Estudo relacionado"}),e.jsxs("div",{className:"mt-1 pl-2 border-l-2 border-blue-200",children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Fonte:"})," ",a.study.source]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Descoberta:"})," ",a.study.finding]}),a.study.application&&e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Aplicação:"})," ",a.study.application]})]})]}),a.reference&&e.jsxs("details",{children:[e.jsx("summary",{className:"font-medium text-gray-900 cursor-pointer",children:"Referência bibliográfica"}),e.jsxs("div",{className:"mt-1 pl-2 border-l-2 border-purple-200",children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Livro:"})," ",a.reference.title]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Autor:"})," ",a.reference.author]})]})]})]})]})}function Le({isOpen:s,onOpenChange:t,habit:i,onApply:r}){const n=i.implementation?{frequency:i.implementation.recommendedFrequency||"daily",bestTime:i.implementation.bestTimeOfDay||"Flexível",suggestedDuration:"test"===i.implementation.durationPeriod?`${i.implementation.testDuration} dias de teste`:"Permanente",implementation:i.implementation}:{frequency:"daily",bestTime:"Flexível",suggestedDuration:"21 dias de teste",implementation:{recommendedFrequency:"daily",recommendedTimes:"1x por dia",durationPeriod:"test",testDuration:21,bestTimeOfDay:"Flexível",progressionSteps:["Defina um horário consistente","Comece aos poucos","Aumente gradualmente"],adaptationTips:["Seja consistente","Monitore seu progresso"],scientificBasis:"Pesquisas indicam que a consistência é chave para formar novos hábitos"}},[o,l]=a.useState({title:i.title,description:i.description,frequency:n.implementation.recommendedFrequency||"daily",date:new Date,time:"08:00",duration:30});return e.jsx(K,{open:s,onOpenChange:t,children:e.jsxs(Q,{className:"sm:max-w-[500px] max-h-[85vh] overflow-y-auto p-0",children:[e.jsx(X,{className:"p-4 pb-2",children:e.jsxs(Y,{className:"text-lg font-semibold",children:["Adicionar: ",i.title]})}),e.jsxs(Z,{className:"p-4 pt-2",children:[e.jsx("div",{className:"mb-4",children:e.jsx(Me,{habit:i,onFormChange:l})}),e.jsx(je,{className:"my-3"}),e.jsxs("details",{className:"mb-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:"Ver recomendações baseadas em pesquisas"}),e.jsx("div",{className:"mt-3 pl-2",children:e.jsx(He,{plan:n,habit:i})})]})]}),e.jsxs(ee,{className:"p-3 border-t border-gray-100",children:[e.jsx(O,{variant:"outline",size:"sm",onClick:()=>t(!1),children:"Cancelar"}),e.jsx(O,{onClick:()=>{i.title=o.title,i.description=o.description,i.implementation?(i.implementation.recommendedFrequency=o.frequency,i.implementation.time=o.time,i.implementation.recommended_duration=o.duration):i.implementation={...n.implementation,recommendedFrequency:o.frequency,time:o.time,recommended_duration:o.duration},r()},size:"sm",className:"bg-gradient-to-r from-[#9b87f5] to-[#7E69AB] text-white",children:"Adicionar à Agenda"})]})]})})}const $e=({tip:s,isSaved:a,onSave:t,onAdd:r,areaIcons:n,areaNames:o,sourceIcons:l})=>{const c=n[s.area];return e.jsxs(we,{className:"relative transition-all duration-300 hover:shadow-md border border-gray-100 hover:border-primary/30 rounded-xl overflow-hidden bg-white hover:translate-y-[-2px] group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-[#9b87f5] to-[#7E69AB]"}),e.jsxs(Te,{className:"flex flex-row items-center justify-between p-4 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(c,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-gray-700",children:o[s.area]}),e.jsx(se,{variant:"outline",className:"bg-primary/5 text-[10px] font-normal border-0 px-1.5 py-0 h-4 mt-0.5",children:"goal"===s.type?"Meta":"Hábito"})]})]}),e.jsx(O,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full "+(a?"text-primary bg-primary/10 hover:bg-primary/20":"text-gray-400 hover:text-primary hover:bg-primary/5"),onClick:()=>t(s.id),children:a?e.jsx(i,{className:"h-4 w-4"}):e.jsx(x,{className:"h-4 w-4"})})]}),e.jsxs(Se,{className:"p-4 pt-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-base leading-tight",children:s.title}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 line-clamp-2",children:s.description}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1.5",children:[s.tags.slice(0,3).map((s=>e.jsx(se,{variant:"secondary",className:"text-[10px] bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors duration-200 rounded-full py-0 px-2 h-5",children:s},s))),s.tags.length>3&&e.jsxs(se,{variant:"secondary",className:"text-[10px] bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors duration-200 rounded-full py-0 px-2 h-5",children:["+",s.tags.length-3]})]}),(s.reference||s.study||s.quote)&&e.jsxs("div",{className:"mt-3 flex items-center gap-1.5 text-xs text-gray-500",children:[e.jsx("div",{className:"p-1 rounded-md bg-primary/5 text-primary",children:"book"===s.source_type?e.jsx(h,{className:"h-3.5 w-3.5"}):"study"===s.source_type?e.jsx(g,{className:"h-3.5 w-3.5"}):"quote"===s.source_type?e.jsx(f,{className:"h-3.5 w-3.5"}):null}),e.jsx("span",{className:"truncate",children:s.reference?s.reference.title:s.study?s.study.source:s.quote?`"${s.quote.text.substring(0,30)}..."`:""})]})]}),e.jsx(Ae,{className:"p-4 pt-0",children:e.jsxs(O,{className:"w-full bg-gradient-to-r from-[#9b87f5] to-[#7E69AB] hover:opacity-90 transition-all duration-300 rounded-lg text-white py-2 text-sm font-medium h-9 group-hover:shadow-sm",onClick:()=>r(s),children:[e.jsx("span",{className:"mr-1",children:"Adicionar"}),e.jsx(u,{className:"h-3.5 w-3.5 transition-transform duration-300 group-hover:translate-x-0.5"})]})})]})},Re=({tips:a,savedTipIds:t,isLoading:i,progressValue:r,onFetchSuggestions:n,onSaveTip:o,onAddTip:l,areaIcons:c,areaNames:d,sourceIcons:m})=>e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#9b87f5]/10 to-[#7E69AB]/10 p-5 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2.5 bg-primary/20 rounded-full",children:e.jsx(y,{className:"w-5 h-5 text-primary"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Sugestões de IA"})]}),e.jsx("p",{className:"text-sm text-gray-600 ml-12",children:"Recomendações personalizadas geradas por inteligência artificial com base no seu perfil."})]}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(O,{onClick:n,disabled:i,className:"flex items-center justify-between gap-3 bg-gradient-to-r from-[#9b87f5] to-[#7E69AB] text-white shadow-md hover:shadow-lg transition-all duration-300 rounded-xl border-0 py-3 px-[18px] disabled:opacity-70",children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2 text-white",children:"⭮"}),e.jsx("span",{children:"Gerando sugestões..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Gerar Novas Sugestões"})]}),e.jsx(u,{className:"w-4 h-4 text-white ml-2"})]})})}),i&&e.jsxs("div",{className:"space-y-4 py-6 bg-gradient-to-r from-[#9b87f5]/5 to-[#7E69AB]/5 p-6 rounded-xl border border-primary/10",children:[e.jsxs("div",{className:"flex items-center gap-3 text-primary",children:[e.jsx(s,{className:"w-5 h-5 animate-pulse"}),e.jsx("p",{className:"font-medium",children:"Gerando recomendações personalizadas..."})]}),e.jsx(Fe,{value:r,className:"h-2"}),e.jsx("p",{className:"text-sm text-gray-600 text-center mt-2",children:"A IA está analizando seus dados e criando um plano personalizado baseado em evidências científicas"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i?Array.from({length:3}).map(((s,a)=>e.jsxs(we,{className:"p-6 border-gray-100 rounded-xl",children:[e.jsx(Pe,{className:"h-4 w-1/3 mb-5"}),e.jsx(Pe,{className:"h-24 w-full mb-5"}),e.jsx(Pe,{className:"h-4 w-2/3 mb-3"}),e.jsx(Pe,{className:"h-4 w-1/2 mb-5"}),e.jsx(Pe,{className:"h-12 w-full rounded-lg"})]},`skeleton-${a}`))):a.length>0?a.map((s=>e.jsx($e,{tip:s,isSaved:t.has(s.id),onSave:o,onAdd:l,areaIcons:c,areaNames:d,sourceIcons:m},s.id))):e.jsxs("div",{className:"col-span-full text-center py-12 bg-gradient-to-r from-[#9b87f5]/5 to-[#7E69AB]/5 rounded-xl border border-dashed border-primary/20",children:[e.jsx(s,{className:"w-12 h-12 text-primary mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-gray-700 font-medium mb-2",children:"Nenhuma sugestão personalizada disponível"}),e.jsx("p",{className:"text-gray-600 text-sm max-w-md mx-auto",children:"Clique no botão acima para gerar sugestões personalizadas com IA baseadas no seu perfil"})]})})]}),Ge=({tips:t,savedTipIds:i,onShuffle:r,onSaveTip:n,onAddTip:o,areaIcons:l,areaNames:c,sourceIcons:d})=>{const[m,p]=a.useState(!1);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#9b87f5]/10 to-[#7E69AB]/10 p-5 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2.5 bg-primary/20 rounded-full",children:e.jsx(h,{className:"w-5 h-5 text-primary"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Baseado em Pesquisas"})]}),e.jsx("p",{className:"text-sm text-gray-600 ml-12",children:"Sugestões de hábitos e metas baseadas em estudos científicos e literatura especializada."})]}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs(O,{onClick:()=>{p(!0),r(),setTimeout((()=>{p(!1)}),800)},disabled:m,className:"flex items-center justify-between gap-3 bg-gradient-to-r from-[#9b87f5] to-[#7E69AB] text-white shadow-md hover:shadow-lg transition-all duration-300 rounded-xl border-0 px-[18px] py-[12px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(j,{className:"w-4 h-4 text-white animate-spin"}):e.jsx(s,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:m?"Carregando...":"Descobrir Novos Insights"})]}),e.jsx(u,{className:"w-4 h-4 text-white ml-2"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((s=>e.jsx($e,{tip:s,isSaved:i.has(s.id),onSave:n,onAdd:o,areaIcons:l,areaNames:c,sourceIcons:d},s.id)))})]})},Ue=({isOpen:t,onOpenChange:i,currentTips:r,aiTips:n,savedTipIds:o,isLoadingAI:l,progressValue:c,onShuffle:d,onFetchAI:m,onSaveTip:u,onAddTip:p,areaIcons:x,areaNames:g,sourceIcons:f})=>(a.useEffect((()=>()=>{}),[]),e.jsx(K,{open:t,onOpenChange:i,"data-dialog-trigger":"suggestions",children:e.jsxs(Q,{className:"max-w-4xl max-h-[85vh] overflow-y-auto md:mx-auto mx-0 my-0 rounded-3xl p-0 border-0 shadow-xl",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white rounded-t-3xl border-b border-gray-100",children:[e.jsxs(X,{className:"space-y-3 bg-gradient-to-r from-[#9b87f5]/10 to-[#7E69AB]/10 p-7 rounded-t-3xl relative",children:[e.jsx(O,{variant:"ghost",size:"icon",onClick:()=>i(!1),className:"rounded-full absolute right-5 top-5 hover:bg-black/5",children:e.jsx(v,{className:"h-5 w-5 text-gray-600"})}),e.jsxs(Y,{className:"flex items-center gap-3 text-xl md:text-2xl text-gray-800",children:[e.jsx(N,{className:"w-6 h-6 text-primary"}),"Insights e Sugestões Personalizadas"]}),e.jsx(ae,{className:"text-base text-gray-600",children:"Recomendações baseadas em pesquisas e análise de IA para melhorar sua vida"})]}),e.jsx(Ce,{defaultValue:"research",className:"px-7 pt-4 pb-2",children:e.jsxs(qe,{className:"grid w-full grid-cols-2 p-1 bg-gray-100 rounded-lg",children:[e.jsxs(Ie,{value:"research",className:"rounded-md py-2.5 data-[state=active]:bg-white data-[state=active]:text-primary data-[state=active]:shadow-sm",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Baseado em Pesquisas"]}),e.jsxs(Ie,{value:"ai",className:"rounded-md py-2.5 data-[state=active]:bg-white data-[state=active]:text-primary data-[state=active]:shadow-sm",children:[e.jsx(s,{className:"w-4 h-4 mr-2"}),"Sugestões IA"]})]})})]}),e.jsx("div",{className:"p-7",children:e.jsxs(Ce,{defaultValue:"research",children:[e.jsx(De,{value:"research",className:"mt-0 focus-visible:outline-none focus-visible:ring-0",children:e.jsx(Ge,{tips:r,savedTipIds:o,onShuffle:d,onSaveTip:u,onAddTip:p,areaIcons:x,areaNames:g,sourceIcons:f})}),e.jsx(De,{value:"ai",className:"mt-0 focus-visible:outline-none focus-visible:ring-0",children:e.jsx(Re,{tips:n,savedTipIds:o,isLoading:l,progressValue:c,onFetchSuggestions:m,onSaveTip:u,onAddTip:p,areaIcons:x,areaNames:g,sourceIcons:f})})]})})]})})),Ve=({isOpen:s,onOpenChange:a,favoriteTips:t,onSaveTip:i,onAddTip:r,areaIcons:n,areaNames:o,sourceIcons:l})=>e.jsx(K,{open:s,onOpenChange:a,children:e.jsxs(Q,{className:"max-w-4xl max-h-[80vh] overflow-y-auto mx-3 md:mx-auto",children:[e.jsxs(X,{className:"space-y-2",children:[e.jsxs(Y,{className:"flex items-center gap-2 text-xl md:text-2xl",children:[e.jsx(b,{className:"w-6 h-6 text-primary"}),"Sugestões Favoritas"]}),e.jsx(ae,{className:"text-base",children:"Suas sugestões salvas para referência futura"})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map((s=>e.jsx($e,{tip:s,isSaved:!0,onSave:i,onAdd:r,areaIcons:n,areaNames:o,sourceIcons:l},s.id))),0===t.length&&e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx(b,{className:"w-8 h-8 text-primary mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Você ainda não salvou nenhuma sugestão como favorita."})]})]})]})});const Je=({isOpen:s,setIsOpen:a,currentTips:t,aiTips:i,savedTips:r,isLoadingAI:n,progressValue:o,showFavorites:l,setShowFavorites:c,isConfirmDialogOpen:d,setIsConfirmDialogOpen:m,selectedTip:u,habitPlan:p,shuffleTips:x,getFavoriteTips:h,handleAdd:g,toggleSaveTip:f,fetchAISuggestions:y,stopProgress:j,areaIcons:v,areaNames:N,sourceIcons:b,onAddHabit:w})=>{const{handleConfirmHabit:T}=function({onAddHabit:e}){const{toast:s}=te();return{handleConfirmHabit:async a=>{if(a&&a.title)try{let t="daily";const i=a.description.toLowerCase();i.includes("semana")||i.includes("semanal")||i.includes("por semana")?t="weekly":(i.includes("mês")||i.includes("mensal")||i.includes("por mês"))&&(t="monthly");let r=a.area;r||(i.includes("saúde")||i.includes("exercício")||i.includes("treino")?r="health":i.includes("negócio")||i.includes("trabalho")||i.includes("carreira")?r="business":i.includes("família")||i.includes("relacionamento")?r="family":i.includes("dinheiro")||i.includes("finança")?r="finances":(i.includes("espiritual")||i.includes("meditação"))&&(r="spirituality"));let n="08:00";i.includes("noite")||i.includes("dormir")?n="21:00":i.includes("tarde")?n="15:00":i.includes("almoço")?n="12:00":i.includes("manhã")&&(n="08:00");const o=a.implementation||void 0;return e(r,a.title,a.description,{...o,frequency:t,time:n,recommended_duration:(null==o?void 0:o.recommended_duration)||30}),s({title:"Hábito adicionado",description:`O hábito "${a.title}" foi adicionado com sucesso à sua rotina ${"daily"===t?"diária":"weekly"===t?"semanal":"mensal"}.`,duration:5e3}),!0}catch(t){return s({title:"Erro",description:"Não foi possível adicionar o hábito. Por favor, tente novamente.",variant:"destructive"}),!1}else s({title:"Erro",description:"Informações do hábito incompletas. Por favor, tente novamente.",variant:"destructive"})}}}({onAddHabit:w});return e.jsxs(e.Fragment,{children:[e.jsx(Ue,{isOpen:s,onOpenChange:e=>{e||j(),a(e)},currentTips:t,aiTips:i,savedTipIds:r,isLoadingAI:n,progressValue:o,onShuffle:x,onFetchAI:y,onSaveTip:f,onAddTip:g,areaIcons:v,areaNames:N,sourceIcons:b}),e.jsx(Ve,{isOpen:l,onOpenChange:c,favoriteTips:h(),onSaveTip:f,onAddTip:g,areaIcons:v,areaNames:N,sourceIcons:b}),u&&p&&e.jsx(Le,{isOpen:d,onOpenChange:m,habit:u,onApply:async()=>{if(u)try{await T(u)&&m(!1)}catch(e){}}})]})},We={health:[{title:"Meditação Matinal",description:"Comece seu dia com 10 minutos de meditação para clareza mental",area:"health",type:"habit",source_type:"study",tags:["mindfulness","bem-estar"],study:{finding:"A meditação regular reduz o estresse em até 40% e melhora a clareza mental",source:"Journal of Mindfulness Research",application:"Prática diária por 8 semanas mostrou resultados significativos"},implementation:{recommendedFrequency:"daily",recommendedTimes:"1x por dia",durationPeriod:"test",testDuration:21,bestTimeOfDay:"Manhã",progressionSteps:["Comece com 5 minutos","Aumente para 10 minutos","Experimente diferentes técnicas"],adaptationTips:["Use app de meditação guiada","Crie espaço dedicado"],scientificBasis:"Estudos mostram que a meditação regular reduz estresse e melhora foco"}},{title:"Hidratação Constante",description:"Beber 2 litros de água diariamente para melhorar saúde geral",area:"health",type:"habit",source_type:"study",tags:["hidratação","saúde"],study:{finding:"A hidratação adequada melhora a função cognitiva em até 30%",source:"Journal of Hydration Science",application:"Beber água regularmente ao longo do dia é mais eficaz"},implementation:{recommendedFrequency:"daily",recommendedTimes:"8x por dia",durationPeriod:"permanent",bestTimeOfDay:"Ao longo do dia",progressionSteps:["Comece com 1 litro","Aumente para 2 litros","Distribua ao longo do dia"],adaptationTips:["Use garrafa marcada com horários","Configure lembretes no celular"],scientificBasis:"A hidratação adequada é essencial para todas as funções corporais"}}],business:[{title:"Planejamento Semanal",description:"Dedique 30 minutos todo domingo para planejar sua semana",area:"business",type:"habit",source_type:"book",tags:["produtividade","organização"],reference:{title:"Getting Things Done",author:"David Allen"},implementation:{recommendedFrequency:"weekly",recommendedTimes:"1x por semana",durationPeriod:"permanent",bestTimeOfDay:"Domingo à noite",progressionSteps:["Liste todas as tarefas pendentes","Priorize por importância","Distribua ao longo da semana"],adaptationTips:["Use um aplicativo de planejamento","Bloquei horários específicos no calendário"],scientificBasis:"O planejamento proativo reduz estresse e aumenta produtividade"}}],family:[{title:"Jantar em Família",description:"Reserve tempo para jantar com a família sem eletrônicos",area:"family",type:"habit",source_type:"study",tags:["conexão","relacionamento"],study:{finding:"Jantares em família regulares melhoram coesão familiar em 40%",source:"Journal of Family Psychology",application:"Pelo menos 3 vezes por semana mostra resultados significativos"},implementation:{recommendedFrequency:"weekly",recommendedTimes:"3x por semana",durationPeriod:"permanent",bestTimeOfDay:"Noite",progressionSteps:["Estabeleça dias fixos","Crie regras sobre eletrônicos","Inclua conversas significativas"],adaptationTips:["Prepare refeições com antecedência","Envolva todos na preparação"],scientificBasis:"Refeições compartilhadas fortalecem vínculos familiares"}}],finances:[{title:"Revisão Financeira Semanal",description:"Dedique 15 minutos para revisar gastos e orçamento",area:"finances",type:"habit",source_type:"study",tags:["finanças","orçamento"],study:{finding:"Revisão regular aumenta economia em 12-15% em média",source:"Journal of Financial Planning",application:"Mais eficaz quando feito em dia fixo da semana"},implementation:{recommendedFrequency:"weekly",recommendedTimes:"1x por semana",durationPeriod:"permanent",bestTimeOfDay:"Domingo à noite",progressionSteps:["Registre todos os gastos","Compare com o orçamento","Ajuste planos para a próxima semana"],adaptationTips:["Use aplicativo de finanças","Automatize categorização de gastos"],scientificBasis:"Consciência financeira regular melhora hábitos de consumo"}}],spirituality:[{title:"Gratidão Diária",description:"Anote 3 coisas pelas quais você é grato todos os dias",area:"spirituality",type:"habit",source_type:"study",tags:["gratidão","bem-estar"],study:{finding:"Prática de gratidão aumenta bem-estar em 25%",source:"Journal of Positive Psychology",application:"Mais eficaz quando feito por escrito"},implementation:{recommendedFrequency:"daily",recommendedTimes:"1x por dia",durationPeriod:"test",testDuration:30,bestTimeOfDay:"Noite",progressionSteps:["Comece com 3 itens simples","Evite repetir os mesmos itens","Reflita sobre o porquê da gratidão"],adaptationTips:["Use um diário dedicado","Faça antes de dormir para melhor descanso"],scientificBasis:"Gratidão ativa áreas cerebrais relacionadas ao bem-estar"}}]},Ke=e=>e.implementation?{frequency:e.implementation.recommendedFrequency,bestTime:e.implementation.bestTimeOfDay,suggestedDuration:"test"===e.implementation.durationPeriod?`${e.implementation.testDuration} dias de teste`:"Permanente",implementation:e.implementation}:"health"===e.area?{frequency:"daily",bestTime:"Manhã",suggestedDuration:"21 dias de teste",implementation:{recommendedFrequency:"daily",recommendedTimes:"1x por dia",durationPeriod:"test",testDuration:21,bestTimeOfDay:"Manhã",progressionSteps:["Comece devagar e aumente gradualmente","Estabeleça um horário fixo","Monitore seu progresso"],adaptationTips:["Comece com sessões curtas","Crie lembretes visuais"],scientificBasis:"Estudos mostram que hábitos de saúde são mais efetivos quando praticados pela manhã"}}:{frequency:"daily",implementation:{recommendedFrequency:"daily",recommendedTimes:"1x por dia",durationPeriod:"permanent",bestTimeOfDay:"Flexível",progressionSteps:["Defina um horário consistente","Comece aos poucos","Aumente gradualmente"],adaptationTips:["Seja consistente","Monitore seu progresso"],scientificBasis:"Pesquisas indicam que a consistência é chave para formar novos hábitos"}},Qe=e=>{try{return Array.isArray(e)&&0!==e.length?e.map(((e,s)=>({id:`ai-${Date.now()}-${s}`,area:e.area||"health",title:e.title||"Nova Sugestão",description:e.description||"",type:e.type||"habit",source_type:e.source_type||"study",tags:Array.isArray(e.tags)?e.tags:[],implementation:e.implementation,study:e.study,reference:e.reference,quote:e.quote}))):[]}catch(s){return[]}},Xe=({onAddGoal:e,onAddHabit:s,areaNames:t})=>{const[i,r]=a.useState(!1),[n,o]=a.useState(null),[l,c]=a.useState(new Set),[d,m]=a.useState([]),[u,p]=a.useState([]),[x,h]=a.useState(new Set),[g,f]=a.useState(!1),[y,j]=a.useState(null),[v,N]=a.useState(!1),[b,w]=a.useState(!1);a.useState(0);const[T,S]=a.useState(0),[A,C]=a.useState(null),[q,I]=a.useState([]),{toast:D}=te(),O=[{id:"1",area:"health",title:"Morning Meditation",description:"Start your day with 10 minutes of meditation to improve mental clarity and focus.",type:"habit",source_type:"study",tags:["mindfulness","morning","focus"],study:{finding:"Regular meditation improves mental focus by 30%",source:"Journal of Mindfulness",application:"Daily practice recommended"}},{id:"2",area:"business",title:"Weekly Planning Session",description:"Schedule 30 minutes every Sunday to plan your week ahead and set priorities.",type:"habit",source_type:"book",tags:["productivity","planning","organization"],reference:{title:"Getting Things Done",author:"David Allen"}},{id:"3",area:"health",title:"Drink Water Before Meals",description:"Drink a glass of water 15 minutes before each meal to improve digestion and prevent overeating.",type:"habit",source_type:"study",tags:["hydration","nutrition","health"],study:{finding:"Drinking water before meals can reduce calorie intake by 13%",source:"Journal of Clinical Nutrition",application:"Practice before each meal"}}],F=async()=>{try{const{data:{user:e}}=await k.auth.getUser();if(!e)return;const{data:s,error:a}=await k.from("daily_routines").select("title, category").eq("user_id",e.id);if(a)return;const t=s.map((e=>({title:e.title,area:e.category,type:"habit"})));return I(t),t}catch(e){return[]}};a.useEffect((()=>{F()}),[]);const P=()=>{const e=O.filter((e=>!x.has(e.id)));return e.length<6?(h(new Set),[...O].sort((()=>Math.random()-.5)).slice(0,6)):e.sort((()=>Math.random()-.5)).slice(0,6)},E=a.useCallback((async()=>{N(!0),z();try{m([]);const e=await F()||[];h(new Set);const s=await(async(e=[])=>{try{try{const{data:s,error:a}=await k.functions.invoke("generate-suggestions",{body:{type:"all-areas",existingHabits:e}});if(!a&&(null==s?void 0:s.suggestions)&&Array.isArray(s.suggestions)&&s.suggestions.length>0)return Qe(s.suggestions)}catch(s){}const a=[];for(const s of Object.keys(We)){const t=We[s],i=t.filter((s=>!e.some((e=>e.title.toLowerCase()===s.title.toLowerCase()&&e.area===s.area))));i.length>0?a.push(i[0]):t.length>0&&a.push(t[0])}return Qe(a)}catch(a){const e=[We.health[0],We.business[0]];return Qe(e)}})(e);if(s&&s.length>0){const e=[...s].sort((()=>Math.random()-.5));m(e);const a=new Set;e.forEach((e=>a.add(e.id))),h(a)}else{const e=P();m(e);const s=new Set;e.forEach((e=>s.add(e.id))),h(s)}}catch(e){const s=P();m(s)}finally{_(),N(!1),i&&D({title:"Novas sugestões carregadas!",description:"Confira as novas recomendações baseadas em pesquisas."})}}),[D,i]);a.useEffect((()=>{0===d.length&&E()}),[d.length,E]);const z=()=>{S(0);const e=setInterval((()=>{S((s=>s>=100?(clearInterval(e),100):s+5))}),200);C(e)},_=()=>{A&&(clearInterval(A),C(null)),S(100),setTimeout((()=>S(0)),300)};return{isOpen:i,setIsOpen:r,selectedTip:n,savedTips:l,currentTips:d,aiTips:u,isConfirmDialogOpen:g,setIsConfirmDialogOpen:f,habitPlan:y,isLoadingAI:v,showFavorites:b,setShowFavorites:w,progressValue:T,shuffleTips:E,getFavoriteTips:()=>O.filter((e=>l.has(e.id))),handleAdd:async s=>{if("goal"===s.type)e(s.area,s.title),D({title:"Meta adicionada!",description:`${s.title} foi adicionada como meta em ${t[s.area]}.`}),o(null);else try{if(o(s),N(!0),s.implementation)j({frequency:s.implementation.recommendedFrequency,bestTime:s.implementation.bestTimeOfDay,suggestedDuration:"test"===s.implementation.durationPeriod?`${s.implementation.testDuration} dias de teste`:"Permanente",implementation:s.implementation});else{const e=await(async(e,s)=>{try{try{const{data:a,error:t}=await k.functions.invoke("generate-suggestions",{body:{habit:e,area:s,type:"implementation"}});if(!t&&(null==a?void 0:a.suggestions)&&Array.isArray(a.suggestions)){const s=a.suggestions.find((s=>s.title===e))||a.suggestions[0];if(null==s?void 0:s.implementation)return s}}catch(a){}const t=s;if(We[t]){const s=We[t].find((s=>s.title.toLowerCase()===e.toLowerCase()));if(s)return s}return Ke({id:"default",area:s,title:e,type:"habit",source_type:"study",description:"",tags:[]})}catch(t){throw t}})(s.title,s.area);if(e.implementation)j({frequency:e.implementation.recommendedFrequency,bestTime:e.implementation.bestTimeOfDay,suggestedDuration:"test"===e.implementation.durationPeriod?`${e.implementation.testDuration} dias de teste`:"Permanente",implementation:e.implementation});else{const e=Ke(s);j(e)}}f(!0)}catch(a){D({variant:"destructive",title:"Erro ao carregar recomendações",description:"Não foi possível obter as recomendações específicas para este hábito. Usando recomendações padrão."});const e=Ke(s);j(e),f(!0)}finally{N(!1)}},handleConfirmHabit:()=>{n&&y&&(s(n.area,n.title,n.description,y.implementation),D({title:"Hábito adicionado!",description:`${n.title} foi adicionado como hábito em ${t[n.area]}.`}),f(!1),o(null),j(null),F())},toggleSaveTip:e=>{const s=new Set(l);l.has(e)?(s.delete(e),D({title:"Removido dos favoritos",description:"A sugestão foi removida da sua lista de favoritos."})):(s.add(e),D({title:"Salvo nos favoritos!",description:"A sugestão foi salva na sua lista de favoritos."})),c(s)},fetchAISuggestions:async()=>{N(!0),z();try{const e=await F()||[],{data:s,error:a}=await k.functions.invoke("generate-suggestions",{body:{area:"health",existingHabits:e,userContext:{existingHabits:e.length}}});if(a)throw new Error(a.message);if(!s||!s.suggestions)throw new Error("Resposta inválida da IA");const t=Array.isArray(s.suggestions)?s.suggestions:[],r=Qe(t);p(r),i&&D({title:"Novas sugestões geradas!",description:"O assistente IA criou recomendações personalizadas para você."})}catch(e){i&&D({variant:"destructive",title:"Erro ao gerar sugestões",description:"Não foi possível gerar novas sugestões no momento. Por favor, tente novamente."})}finally{_(),N(!1)}},stopProgress:_,existingHabits:q}};function Ye({entries:s}){if(!s||0===s.length)return e.jsx(we,{className:"shadow-sm",children:e.jsx(Se,{className:"p-4",children:e.jsx("p",{className:"text-center text-gray-500 text-sm",children:"Nenhum registro de humor disponível."})})});const a=s.reduce(((e,s)=>{if(!s.created_at)return e;const a=s.created_at.split("T")[0];return e[a]||(e[a]=[]),e[a].push(s),e}),{});if(0===Object.keys(a).length)return e.jsx(we,{className:"shadow-sm",children:e.jsx(Se,{className:"p-4",children:e.jsx("p",{className:"text-center text-gray-500 text-sm",children:"Nenhum registro de humor válido disponível."})})});const t=Object.keys(a).sort().reverse().slice(0,3),i={};return t.forEach((e=>{i[e]=a[e]})),e.jsxs("div",{className:"space-y-4",children:[Object.entries(i).map((([s,a])=>{const t=a[0];if(!t.created_at)return null;try{const i=Ne(t.created_at),r=ve(i,"EEE",{locale:be}),n=ve(i,"dd"),o=(e=>{try{const s=Ne(e);return ve(s,"MMMM",{locale:be})}catch(s){return""}})(t.created_at);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 capitalize flex items-center",children:[e.jsx("span",{className:"capitalize",children:r}),e.jsx("span",{className:"mx-1",children:n}),e.jsx("span",{className:"capitalize",children:o})]}),e.jsx("div",{className:"space-y-2",children:a.map((s=>{if(!s.created_at||!s.mood_type)return null;try{const a=ve(Ne(s.created_at),"HH:mm"),t=(e=>{switch(e){case"anxiety":return"Ansiedade";case"anger":return"Raiva";case"fatigue":return"Cansaço";case"sadness":return"Tristeza";case"vigor":return"Vigor";case"happiness":return"Alegria";default:return""}})(s.mood_type),i=(e=>{switch(e){case"anxiety":return"bg-amber-400";case"anger":return"bg-rose-500";case"fatigue":return"bg-sky-400";case"sadness":return"bg-indigo-500";case"vigor":return"bg-emerald-500";case"happiness":return"bg-pink-400";default:return"bg-gray-400"}})(s.mood_type),r=(e=>{if(!e)return[];const s=e.match(/Gatilhos: (.*?)($|\n)/);return s&&s[1]?s[1].split(", ").map((e=>e.trim())):[]})(s.note);return e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(we,{className:"w-full shadow-none border border-gray-100",children:e.jsxs(Se,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${i} flex-shrink-0`}),e.jsx("span",{className:"text-sm font-medium",children:t})]}),e.jsx("span",{className:"text-xs text-gray-400 flex-shrink-0",children:a})]}),r.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:r.map(((s,a)=>e.jsx("span",{className:"inline-block bg-gray-100 rounded-full px-2 py-0.5 text-xs text-gray-600",children:s},a)))})]})})},s.id)}catch(a){return null}}))})]},s)}catch(i){return null}})),Object.keys(a).length>3&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("span",{className:"text-xs text-gray-500",children:"Mostrando registros dos últimos 3 dias"})})]})}function Ze({isOpen:s,onOpenChange:t,selectedArea:i}){const[r,n]=a.useState([]),[o,l]=a.useState([]),[c,d]=a.useState(!0);a.useEffect((()=>{s&&i&&m()}),[s,i]);const m=async()=>{if(i)try{d(!0);const{data:{user:e}}=await k.auth.getUser();if(!e)return;const{data:s,error:a}=await k.from("daily_routines").select("*").eq("user_id",e.id).eq("category",i.areaType).order("scheduled_date",{ascending:!1});if(a)throw a;const t=(null==s?void 0:s.filter((e=>e.completed)))||[],r=(null==s?void 0:s.filter((e=>!e.completed)))||[];n(t),l(r)}catch(e){}finally{d(!1)}};return i?e.jsx(ie,{open:s,onOpenChange:t,children:e.jsxs(re,{children:[e.jsxs(ne,{className:`${i.color} bg-opacity-20 text-gray-800`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`${i.color} text-white p-2 rounded-md`,children:i.icon&&e.jsx(i.icon,{className:"h-5 w-5"})}),e.jsx(oe,{children:i.area})]}),e.jsx(le,{className:"text-gray-700",children:i.description})]}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Progresso atual"}),e.jsx(Fe,{value:i.progress,className:"h-2 w-full",indicatorClassName:i.gradient}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i.progress,"% completo"]})]}),c?e.jsx("p",{className:"text-sm text-gray-500",children:"Carregando dados..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(w,{className:"h-4 w-4 text-green-500"}),"Tarefas e hábitos concluídos recentemente"]}),r.length>0?e.jsx("ul",{className:"space-y-2",children:r.slice(0,5).map((s=>e.jsxs("li",{className:"flex items-start gap-2 bg-green-50 p-2 rounded-md",children:[e.jsx(w,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-gray-500",children:s.description})]})]},s.id)))}):e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma tarefa concluída recentemente."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(v,{className:"h-4 w-4 text-red-500"}),"O que está sendo deixado de lado"]}),o.length>0?e.jsx("ul",{className:"space-y-2",children:o.slice(0,5).map((s=>e.jsxs("li",{className:"flex items-start gap-2 bg-red-50 p-2 rounded-md",children:[e.jsx(v,{className:"h-4 w-4 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-gray-500",children:s.description})]})]},s.id)))}):e.jsx("p",{className:"text-sm text-gray-500",children:"Sem tarefas pendentes nesta área."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(T,{className:"h-4 w-4 text-amber-500"}),"Sugestões para melhorar"]}),o.length>0?e.jsxs("div",{className:"bg-amber-50 p-3 rounded-md",children:[e.jsxs("p",{className:"text-sm",children:["Para aumentar seu progresso em ",e.jsx("strong",{children:i.area}),", considere:"]}),e.jsxs("ul",{className:"list-disc list-inside text-sm mt-2 space-y-1",children:[o.slice(0,3).map((s=>e.jsxs("li",{children:['Retomar "',s.title,'"']},s.id))),i.progress<50&&e.jsxs("li",{children:["Criar novos hábitos relacionados à ",i.area.toLowerCase()]})]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Continue mantendo seus bons hábitos!"})]})]})]})})]})}):null}function es(){const{areaProgress:s,setAreaProgress:t}=he();D(),a.useState(!1);const[i,r]=a.useState({}),[n,o]=a.useState(!1),[l,c]=a.useState(null);a.useEffect((()=>{if(s&&Array.isArray(s)&&s.length>0){const e={};s.forEach((s=>{e[s.areaType]=s.questionnaireScore||0})),r(e)}}),[s]);const d=s=>{try{if(!s)return e.jsx(S,{className:"h-5 w-5"});if(!s.areaType)return e.jsx(S,{className:"h-5 w-5"});switch(s.areaType){case"health":default:return e.jsx(S,{className:"h-5 w-5"});case"business":return e.jsx(I,{className:"h-5 w-5"});case"finances":return e.jsx(q,{className:"h-5 w-5"});case"spirituality":return e.jsx(C,{className:"h-5 w-5"});case"family":return e.jsx(A,{className:"h-5 w-5"})}}catch(a){return e.jsx(S,{className:"h-5 w-5"})}};return s&&Array.isArray(s)?0===s.length?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Acompanhamento de Áreas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Ainda não há áreas para acompanhar. Comece adicionando atividades."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Acompanhamento de Áreas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Acompanhe seu progresso em cada área da vida com base nas suas atividades"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.map((s=>s&&s.areaType?e.jsxs(we,{className:"overflow-hidden cursor-pointer hover:shadow-md transition-shadow",onClick:()=>(e=>{e&&(c(e),o(!0))})(s),children:[e.jsxs(Te,{className:`flex flex-row items-center space-y-0 gap-2 pb-2 ${s.color||"bg-gray-100"} bg-opacity-10`,children:[e.jsx("div",{className:`${s.color||"bg-gray-400"} text-white p-2 rounded-md`,children:d(s)}),e.jsx("div",{className:"flex-1",children:e.jsx(ke,{className:"text-base",children:s.area||"Área não identificada"})})]}),e.jsxs(Se,{className:"pt-4",children:[e.jsx(Oe,{className:"mb-4 text-xs",children:s.description||"Sem descrição disponível"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progresso atual"}),e.jsxs("span",{className:"text-sm font-medium",children:["number"==typeof s.progress?s.progress:0,"%"]})]}),e.jsx(Fe,{value:"number"==typeof s.progress?s.progress:0,className:"h-2.5 w-full",indicatorClassName:s.gradient||"bg-gray-300"}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsx("span",{children:"Tarefas completadas nesta área"}),e.jsx("span",{className:"bg-gray-100 px-2 py-0.5 rounded-full text-gray-700",children:"Clique para detalhes"})]})]})]})]},s.areaType):null))}),e.jsx(Ze,{isOpen:n,onOpenChange:o,selectedArea:l})]}):null}function ss(){var s,t,i;const{taskCounts:r,fetchTasks:n,setIsLoading:o,isLoading:l,error:c}=ge(),{areaProgress:m,fetchAreaProgress:u,isLoading:p,error:x}=he(),{moodHistory:y,fetchMoodHistory:j,isLoading:v,error:N}=fe(),{refreshTasks:b}=de(),{user:w}=D(),[T,k]=a.useState(!0),[O,F]=a.useState(null),[P,E]=a.useState(null),[z,_]=a.useState(!1),B=a.useRef(!0),M=(null==(s=null==w?void 0:w.profile)?void 0:s.full_name)||(null==(t=null==w?void 0:w.profile)?void 0:t.username)||(null==(i=null==w?void 0:w.email)?void 0:i.split("@")[0])||"Usuário";a.useEffect((()=>{}),[r,m,y,T,l,p,v,z]);const H=a.useCallback((()=>{}),[T,l,p,v,r,m,y,c,x,N,O,P,z]),L=a.useCallback((async()=>{if(B.current)try{if(k(!0),F(null),_(!1),E("tasks"),o(!0),await n(),!B.current)return;if(E("areas"),await u(),!B.current)return;E("mood"),await j(),E("complete"),_(!0)}catch(e){B.current&&F("Ocorreu um erro ao carregar os dados. Por favor, tente novamente.")}finally{B.current&&(o(!1),k(!1),E(null),H())}}),[n,u,j,o,H,r]);a.useEffect((()=>(B.current=!0,()=>{B.current=!1})),[]),a.useEffect((()=>{L()}),[b]),a.useEffect((()=>{H()}),[r,m,y,T,l,p,v,z,H]);const $=c||x||N||O,R=T||l||p||v,G={health:S,business:I,family:A,spirituality:C,finances:q},U={health:"Saúde",business:"Negócios",family:"Família",spirituality:"Espiritualidade",finances:"Finanças"},V={book:h,study:g,quote:f},J=Xe({onAddGoal:(e,s)=>{},onAddHabit:(e,s,a,t)=>{},areaNames:U});return e.jsxs("div",{className:"px-4 pt-16 pb-3 space-y-5 pb-safe max-w-2xl mx-auto",children:[e.jsx(ze,{}),e.jsx(me,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ee,{userName:M}),e.jsx(Be,{setIsOpen:J.setIsOpen,shuffleTips:J.shuffleTips})]}),$&&e.jsxs(ue,{variant:"destructive",children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx(pe,{children:O||c||x||N||"Ocorreu um erro ao carregar os dados."})]}),e.jsx("div",{children:R&&!z?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Pe,{className:"h-24 w-full rounded-xl"}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx(Pe,{className:"h-8 w-32 rounded-lg"})})]}):e.jsxs("div",{children:[e.jsx(_e,{taskCounts:{today:(null==r?void 0:r.today)||0,completed:(null==r?void 0:r.completed)||0,overdue:(null==r?void 0:r.overdue)||0}}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx(ye,{})})]})}),e.jsx("div",{children:R&&!z?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Pe,{className:"h-4 w-40 mb-2"}),e.jsx(Pe,{className:"h-32 w-full rounded-xl"}),e.jsx(Pe,{className:"h-32 w-full rounded-xl"})]}):m&&Array.isArray(m)&&m.length>0?e.jsx(es,{}):e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Nenhuma área encontrada"})})}),e.jsx("div",{children:R&&!z?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Pe,{className:"h-4 w-40 mb-2"}),e.jsx(Pe,{className:"h-40 w-full rounded-xl"})]}):y&&Array.isArray(y)&&y.length>0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 bg-gradient-to-r from-violet-500/5 to-purple-600/5",children:e.jsx("h2",{className:"text-sm font-medium text-violet-800",children:"Diário de Humor"})}),e.jsx("div",{className:"p-4",children:e.jsx(Ye,{entries:y})})]}):e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Nenhum registro de humor encontrado"})})}),e.jsx(Je,{isOpen:J.isOpen,setIsOpen:J.setIsOpen,currentTips:J.currentTips,aiTips:J.aiTips,savedTips:J.savedTips,isLoadingAI:J.isLoadingAI,progressValue:J.progressValue,showFavorites:J.showFavorites,setShowFavorites:J.setShowFavorites,isConfirmDialogOpen:J.isConfirmDialogOpen,setIsConfirmDialogOpen:J.setIsConfirmDialogOpen,selectedTip:J.selectedTip,habitPlan:J.habitPlan,shuffleTips:J.shuffleTips,getFavoriteTips:J.getFavoriteTips,handleAdd:J.handleAdd,toggleSaveTip:J.toggleSaveTip,fetchAISuggestions:J.fetchAISuggestions,stopProgress:J.stopProgress,areaIcons:G,areaNames:U,sourceIcons:V,onAddHabit:(e,s,a,t)=>{}})]})}export{ss as default};

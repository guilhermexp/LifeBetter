import{j as e,a8 as s,an as a,aO as t,aP as i,aQ as r,aR as n,y as l,aj as o,r as c,aS as d,aT as m,ak as h,ap as x,am as u,aU as p,J as f,K as j,N as y,aw as g,aV as v,ai as N,v as w,aW as b,x as k}from"./vendor-react-Bu_1CUKu.js";import{s as _,H as C,q as S,J as T,B as D,m as M,L as q,I as O,P as E,h as I,i as A,C as H,S as F,d as z,e as P,f as U,g as L,K as $,T as B,n as V,D as R,j as K,k as J,l as W,p as G,o as Q,z as Y,M as X}from"./index-QnHMPHoX.js";import{D as Z,a as ee,b as se,c as ae,d as te}from"./dropdown-menu-cf7j1Lwd.js";import{C as ie,G as re,a as ne,f as le,s as oe}from"./vendor-date-fns-BCWkNTJO.js";import{C as ce}from"./checkbox-C0NHjcbm.js";import{D as de}from"./DeleteAllTasksButton-CsD95Qj5.js";import"./vendor-CaMlX_x-.js";const me=async(e,s)=>{try{return await async function(e,s){const{data:{user:a}}=await _.auth.getUser();if(!a)throw new Error("Usuário não autenticado");const{data:t,error:i}=await _.from("tasks").update(s).eq("parent_task_id",e).eq("user_id",a.id);if(i)throw i;return t}(e,s)}catch(a){throw a}},he=async e=>{try{return await async function(e){const{data:{user:s}}=await _.auth.getUser();if(!s)throw new Error("Usuário não autenticado");const{data:a,error:t}=await _.from("tasks").delete().eq("parent_task_id",e).eq("user_id",s.id);if(t)throw t;return a}(e)}catch(s){throw s}},xe=({item:c,onToggleCompletion:d,onEdit:m,onDelete:h})=>{const{toast:x}=S();return e.jsx("div",{className:T("p-4 rounded-xl transition-all duration-200 bg-white shadow-sm border border-gray-100",c.isCompleted?"bg-gray-50":"bg-white"),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("button",{onClick:()=>d(c.id,c.isCompleted,c.itemType),className:T("h-6 w-6 rounded-full flex items-center justify-center flex-shrink-0 mt-1.5",c.isCompleted?"bg-green-100 border-2 border-green-500":"border-2 border-gray-300 hover:border-purple-500"),children:c.isCompleted&&e.jsx(s,{className:"h-3 w-3 text-green-600"})}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:T("font-medium text-base",c.isCompleted?"text-gray-500 line-through":"text-gray-900"),children:c.title}),e.jsxs("div",{className:"flex items-center mt-1 space-x-2",children:[e.jsxs("span",{className:"flex items-center text-xs text-gray-500",children:[(()=>{if("habit"===c.itemType)return e.jsx(l,{className:"h-5 w-5 text-green-500"});switch(c.type){case"meeting":return e.jsx(o,{className:"h-5 w-5 text-blue-500"});case"event":return e.jsx(o,{className:"h-5 w-5 text-purple-500"});default:return e.jsx(o,{className:"h-5 w-5 text-indigo-500"})}})(),e.jsx("span",{className:"ml-1 capitalize",children:"habit"===c.itemType?"Hábito":c.type})]}),c.start_time&&e.jsxs("span",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(a,{className:"h-3 w-3 mr-1"}),(e=>{if(!e)return null;try{const[s,a]=e.split(":").map(Number),t=new Date;return t.setHours(s),t.setMinutes(a),ie(t,"HH:mm")}catch(s){return e}})(c.start_time)]}),c.frequency&&"once"!==c.frequency&&e.jsx("span",{className:"text-xs bg-purple-100 text-purple-800 px-2 py-0.5 rounded-full",children:"daily"===c.frequency?"Diário":"weekly"===c.frequency?"Semanal":"monthly"===c.frequency?"Mensal":"Customizado"})]}),c.details&&e.jsx("p",{className:T("mt-1 text-sm",c.isCompleted?"text-gray-400":"text-gray-600"),children:c.details})]}),e.jsxs("div",{className:"flex items-center",children:[c.inbox_only&&e.jsx(D,{variant:"outline",size:"sm",className:"mr-1 h-8 border-gray-200 hover:bg-green-50 hover:text-green-600 hover:border-green-200",onClick:async e=>{e.stopPropagation();try{await(async e=>{try{const{data:{user:s}}=await _.auth.getUser();if(!s)throw new Error("Usuário não autenticado");const{data:a,error:t}=await _.from("tasks").select("*").eq("id",e).single();if(t)throw t;if(!a)throw new Error("Task not found");const{data:i,error:r}=await _.from("tasks").update({scheduled:!0}).eq("id",e).eq("user_id",s.id).select();if(r)throw r;if(a.frequency&&"once"!==a.frequency){const e=new Date(a.scheduled_date);await C(a.id,s.id,a.frequency,e,a.title,a.details||"",a.type,a.start_time,a.location,a.duration)}return i}catch(s){throw s}})(c.id),x({title:"task"===c.itemType?"Tarefa confirmada":"Hábito confirmado",description:c.frequency&&"once"!==c.frequency?"Item enviado para o Planner e repetições criadas para os próximos períodos.":"Item enviado para o Planner."})}catch(s){x({variant:"destructive",title:"Erro",description:"Não foi possível confirmar a tarefa para o Planner."})}},children:e.jsx(t,{className:"h-4 w-4"})}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(i,{className:"h-4 w-4"})})}),e.jsxs(se,{align:"end",className:"w-40",children:[e.jsxs(ae,{onClick:()=>m(c),children:[e.jsx(r,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Editar"})]}),e.jsx(te,{}),e.jsxs(ae,{onClick:()=>h(c.id,c.itemType),className:"text-red-600 focus:text-red-600",children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Excluir"})]})]})]})]})]})})]})})};function ue({item:s,onSave:a,onCancel:i}){const[r,n]=c.useState(s.title),[l,o]=c.useState(s.details||""),[p,f]=c.useState(new Date(s.scheduled_date)),[j,y]=c.useState(s.start_time||""),[g,v]=c.useState(s.frequency||"once"),[N,w]=c.useState(s.location),[b,k]=c.useState(s.notification_time||"at_time"),[_,C]=c.useState("string"==typeof s.duration?s.duration:"30min"),[S,T]=c.useState(s.color||"#4285F4"),[R,K]=c.useState(s.subtasks||[]),[J,W]=c.useState(""),[G,Q]=c.useState(!0===s.inbox_only),Y=()=>{J.trim()&&(K([...R,J.trim()]),W(""))};return e.jsxs(e.Fragment,{children:[e.jsxs(M,{className:"space-y-4 px-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"title",children:"Título da Tarefa"}),e.jsx(O,{id:"title",value:r,onChange:e=>n(e.target.value),className:"w-full border-gray-300",placeholder:"Digite o título da tarefa"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Data"}),e.jsxs(E,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:"w-full justify-start text-left font-normal border-gray-300",children:[e.jsx(d,{className:"mr-2 h-4 w-4"}),ie(p,"dd/MM/yyyy")]})}),e.jsx(A,{className:"w-auto p-0 z-50",align:"start",children:e.jsx(H,{mode:"single",selected:p,onSelect:e=>e&&f(e),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"time",children:"Horário"}),e.jsx(O,{id:"time",type:"time",value:j,onChange:e=>y(e.target.value),className:"w-full border-gray-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"frequency",children:"Frequência"}),e.jsxs(F,{value:g,onValueChange:v,children:[e.jsx(z,{id:"frequency",className:"w-full bg-white border-gray-300",children:e.jsx(P,{placeholder:"Selecione a frequência"})}),e.jsxs(U,{className:"bg-white",children:[e.jsx(L,{value:"once",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(d,{className:"h-4 w-4 mr-2 text-blue-600"}),e.jsx("span",{children:"Uma vez"})]})}),e.jsx(L,{value:"daily",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(m,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx("span",{children:"Diário"})]})}),e.jsx(L,{value:"weekly",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(m,{className:"h-4 w-4 mr-2 text-purple-600"}),e.jsx("span",{children:"Semanal"})]})}),e.jsx(L,{value:"monthly",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(m,{className:"h-4 w-4 mr-2 text-amber-600"}),e.jsx("span",{children:"Mensal"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"duration",children:"Duração"}),e.jsxs(F,{value:_,onValueChange:C,children:[e.jsx(z,{id:"duration",className:"w-full bg-white border-gray-300",children:e.jsx(P,{placeholder:"Selecione a duração"})}),e.jsxs(U,{className:"bg-white",children:[e.jsx(L,{value:"5min",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-purple-600"}),e.jsx("span",{children:"5 minutos"})]})}),e.jsx(L,{value:"15min",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-purple-600"}),e.jsx("span",{children:"15 minutos"})]})}),e.jsx(L,{value:"30min",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-blue-600"}),e.jsx("span",{children:"30 minutos"})]})}),e.jsx(L,{value:"45min",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-blue-600"}),e.jsx("span",{children:"45 minutos"})]})}),e.jsx(L,{value:"1h",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx("span",{children:"1 hora"})]})}),e.jsx(L,{value:"1h30",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx("span",{children:"1 hora e 30 minutos"})]})}),e.jsx(L,{value:"2h",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-amber-600"}),e.jsx("span",{children:"2 horas"})]})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"location",children:"Local ou Link da Reunião"}),e.jsxs("div",{className:"flex relative",children:[e.jsx("span",{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-500",children:e.jsx(x,{className:"h-4 w-4"})}),e.jsx(O,{id:"location",value:N||"",onChange:e=>w(e.target.value),className:"w-full pl-8 border-gray-300",placeholder:"Local da atividade ou link da reunião"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"notification",children:"Lembrete"}),e.jsxs(F,{value:b,onValueChange:k,children:[e.jsx(z,{id:"notification",className:"w-full bg-white border-gray-300",children:e.jsx(P,{placeholder:"Selecione o lembrete"})}),e.jsxs(U,{className:"bg-white",children:[e.jsx(L,{value:"none",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2 text-gray-600"}),e.jsx("span",{children:"Sem lembrete"})]})}),e.jsx(L,{value:"at_time",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2 text-gray-600"}),e.jsx("span",{children:"No horário da tarefa"})]})}),e.jsx(L,{value:"5_min_before",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2 text-amber-600"}),e.jsx("span",{children:"5 minutos antes"})]})}),e.jsx(L,{value:"15_min_before",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2 text-blue-600"}),e.jsx("span",{children:"15 minutos antes"})]})}),e.jsx(L,{value:"30_min_before",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2 text-purple-600"}),e.jsx("span",{children:"30 minutos antes"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(q,{htmlFor:"confirm-planner",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(t,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"Enviar para o Planner"})]}),e.jsx($,{id:"confirm-planner",checked:!G,onCheckedChange:e=>Q(!e)})]}),e.jsx("p",{className:"text-xs text-gray-500",children:G?"A tarefa permanecerá apenas na Inbox até ser confirmada para o Planner.":"A tarefa será exibida no Planner e, se recorrente, gerará automaticamente repetições nos próximos períodos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"subtasks",children:"Subtarefas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{id:"newSubtask",value:J,onChange:e=>W(e.target.value),className:"flex-1 border-gray-300",placeholder:"Adicionar subtarefa",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),Y())}}),e.jsx(D,{type:"button",variant:"outline",onClick:Y,className:"border-gray-300",children:"Adicionar"})]}),R.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:R.map(((s,a)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded-lg border border-gray-100",children:[e.jsx("span",{className:"text-sm",children:s}),e.jsx(D,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{const s=[...R];s.splice(e,1),K(s)})(a),className:"text-red-500 hover:text-red-700 hover:bg-red-50 h-8 w-8 p-0",children:"×"})]},a)))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Cor da Tarefa"}),e.jsx("div",{className:"flex justify-between py-2 bg-white p-2 rounded-md border border-gray-200",children:["#EA4335","#FBBC04","#34A853","#4285F4","#9b87f5","#FF6D01"].map((s=>e.jsx("div",{className:"flex flex-col items-center gap-1 cursor-pointer",onClick:()=>T(s),children:e.jsx("div",{className:"w-8 h-8 rounded-full transition-all duration-200 shadow-sm "+(S===s?"ring-2 ring-offset-2 ring-purple-500":""),style:{backgroundColor:s}})},s)))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"details",children:"Detalhes"}),e.jsx(B,{id:"details",value:l,onChange:e=>o(e.target.value),className:"w-full resize-none border-gray-300",placeholder:"Adicione mais detalhes sobre esta tarefa",rows:3})]})]}),e.jsx(V,{className:"bg-gray-50 p-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx(D,{variant:"outline",onClick:i,className:"flex-1 border-gray-300",children:"Cancelar"}),e.jsx(D,{onClick:()=>{const e=ie(p,"yyyy-MM-dd"),t={...s,title:r,details:l,type:s.type,scheduled_date:e,start_time:j,location:N,frequency:g,notification_time:b,duration:_,color:S,subtasks:R,inbox_only:G};a(t)},disabled:!r.trim(),className:"flex-1 bg-gradient-to-r from-purple-600 to-indigo-600",children:"Salvar Alterações"})]})})]})}function pe({item:s,onSave:a,onCancel:i}){const[r,n]=c.useState(s.title),[l,o]=c.useState(s.details||s.description||""),[m,x]=c.useState(new Date(s.scheduled_date)),[f,j]=c.useState(s.start_time||"08:00"),[y,g]=c.useState(s.frequency||s.category||"daily"),[v,N]=c.useState(s.color||"#9b87f5"),[w,b]=c.useState(s.duration_days||21),[k,_]=c.useState(s.notification_time||"at_time"),[C,S]=c.useState("string"==typeof s.duration?s.duration:"15min"),[T,R]=c.useState(!0===s.inbox_only);return e.jsxs(e.Fragment,{children:[e.jsxs(M,{className:"space-y-4 px-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"title",children:"Nome do Hábito"}),e.jsx(O,{id:"title",value:r,onChange:e=>n(e.target.value),className:"w-full border-gray-300",placeholder:"Digite o nome do hábito"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Data de Início"}),e.jsxs(E,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:"w-full justify-start text-left font-normal border-gray-300",children:[e.jsx(d,{className:"mr-2 h-4 w-4"}),ie(m,"dd/MM/yyyy")]})}),e.jsx(A,{className:"w-auto p-0 z-50",align:"start",children:e.jsx(H,{mode:"single",selected:m,onSelect:e=>e&&x(e),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"time",children:"Horário"}),e.jsx(O,{id:"time",type:"time",value:f,onChange:e=>j(e.target.value),className:"w-full border-gray-300"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"duration",children:"Duração da Atividade"}),e.jsxs(F,{value:C,onValueChange:S,children:[e.jsx(z,{id:"duration",className:"w-full bg-white border-gray-300",children:e.jsx(P,{placeholder:"Selecione a duração"})}),e.jsxs(U,{className:"bg-white",children:[e.jsx(L,{value:"5min",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-purple-600"}),e.jsx("span",{children:"5 minutos"})]})}),e.jsx(L,{value:"15min",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-purple-600"}),e.jsx("span",{children:"15 minutos"})]})}),e.jsx(L,{value:"30min",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-blue-600"}),e.jsx("span",{children:"30 minutos"})]})}),e.jsx(L,{value:"45min",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-blue-600"}),e.jsx("span",{children:"45 minutos"})]})}),e.jsx(L,{value:"1h",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx("span",{children:"1 hora"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"frequency",children:"Frequência"}),e.jsxs(F,{value:y,onValueChange:e=>g(e),children:[e.jsx(z,{id:"frequency",className:"w-full bg-white border-gray-300",children:e.jsx(P,{placeholder:"Selecione a frequência"})}),e.jsxs(U,{className:"bg-white",children:[e.jsx(L,{value:"daily",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(p,{className:"h-4 w-4 mr-2 text-blue-600"}),e.jsx("span",{children:"Diário"})]})}),e.jsx(L,{value:"weekly",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(p,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx("span",{children:"Semanal"})]})}),e.jsx(L,{value:"monthly",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(p,{className:"h-4 w-4 mr-2 text-purple-600"}),e.jsx("span",{children:"Mensal"})]})}),e.jsx(L,{value:"custom",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(p,{className:"h-4 w-4 mr-2 text-amber-600"}),e.jsx("span",{children:"Personalizado"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(q,{htmlFor:"confirm-planner-habit",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(t,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"Enviar para o Planner"})]}),e.jsx($,{id:"confirm-planner-habit",checked:!T,onCheckedChange:e=>R(!e)})]}),e.jsx("p",{className:"text-xs text-gray-500",children:T?"O hábito permanecerá apenas na Inbox até ser confirmado para o Planner.":"O hábito será exibido no Planner de acordo com sua frequência e período de duração."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"notification",children:"Notificações"}),e.jsxs(F,{value:k,onValueChange:_,children:[e.jsx(z,{id:"notification",className:"w-full bg-white border-gray-300",children:e.jsx(P,{placeholder:"Selecione o lembrete"})}),e.jsxs(U,{className:"bg-white",children:[e.jsx(L,{value:"at_time",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2 text-gray-600"}),e.jsx("span",{children:"No horário do hábito"})]})}),e.jsx(L,{value:"5_min_before",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2 text-amber-600"}),e.jsx("span",{children:"5 minutos antes"})]})}),e.jsx(L,{value:"15_min_before",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2 text-blue-600"}),e.jsx("span",{children:"15 minutos antes"})]})}),e.jsx(L,{value:"30_min_before",children:e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2 text-purple-600"}),e.jsx("span",{children:"30 minutos antes"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"duration",children:"Duração (dias)"}),e.jsx(O,{id:"duration",type:"number",min:"1",value:w,onChange:e=>b(parseInt(e.target.value)||21),className:"w-full border-gray-300"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Recomendado: 21 dias para formar um novo hábito, 66 dias para hábitos complexos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Cor do Hábito"}),e.jsx("div",{className:"flex justify-between py-2 bg-white p-2 rounded-md border border-gray-200",children:["#EA4335","#FBBC04","#34A853","#4285F4","#9b87f5","#FF6D01"].map((s=>e.jsx("div",{className:"flex flex-col items-center gap-1 cursor-pointer",onClick:()=>N(s),children:e.jsx("div",{className:"w-8 h-8 rounded-full transition-all duration-200 shadow-sm "+(v===s?"ring-2 ring-offset-2 ring-purple-500":""),style:{backgroundColor:s}})},s)))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"details",children:"Detalhes"}),e.jsx(B,{id:"details",value:l,onChange:e=>o(e.target.value),className:"w-full resize-none border-gray-300",placeholder:"Adicione mais detalhes sobre este hábito",rows:3})]})]}),e.jsx(V,{className:"bg-gray-50 p-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx(D,{variant:"outline",onClick:i,className:"flex-1 border-gray-300",children:"Cancelar"}),e.jsx(D,{onClick:()=>{const e=ie(m,"yyyy-MM-dd"),t={...s,title:r,details:l,description:l,category:y,frequency:y,scheduled_date:e,start_time:f,duration_days:w,notification_time:k,duration:C,color:v,inbox_only:T};a(t)},disabled:!r.trim(),className:"flex-1 bg-gradient-to-r from-purple-600 to-indigo-600",children:"Salvar Alterações"})]})})]})}function fe({open:s,onOpenChange:a,item:t,onSave:i}){return t?e.jsx(R,{open:s,onOpenChange:a,children:e.jsxs(K,{className:"max-w-md p-0 overflow-hidden max-h-[90vh] overflow-y-auto animate-fadeIn rounded-xl",children:[e.jsxs(J,{className:"px-6 pt-6 pb-3 bg-gradient-to-r from-purple-50 to-indigo-50",children:[e.jsxs(W,{className:"text-xl font-semibold text-purple-900",children:["Editar ","task"===t.itemType?"Tarefa":"Hábito"]}),e.jsx(G,{className:"text-purple-700 opacity-90",children:"Personalize os detalhes e clique em salvar quando terminar."})]}),"task"===t.itemType?e.jsx(ue,{item:t,onSave:i,onCancel:()=>a(!1)}):e.jsx(pe,{item:t,onSave:i,onCancel:()=>a(!1)})]})}):null}function je({open:s,onOpenChange:t,taskData:i,onTaskDataChange:r,onSave:n}){const[o,m]=c.useState(""),[h,x]=c.useState(!1),[u,p]=c.useState(!1),g=e=>{r({...i,[e.target.name]:e.target.value}),"title"===e.target.name&&p(!0)};c.useEffect((()=>{if(i.title&&u){const e=setTimeout((()=>{const e=(e=>{const s=e.toLowerCase(),a=[/hoje/i,/amanhã/i,/depois de amanhã/i,/(próxima|essa|esta) (segunda|terça|quarta|quinta|sexta|sábado|domingo)/i,/dia (\d{1,2})(\/|-)(\d{1,2})(\/|-)?(\d{2,4})?/i,/(\d{1,2})(\/|-)(\d{1,2})(\/|-)?(\d{2,4})?/i].some((e=>e.test(s))),t=[/(\d{1,2})[h:.](\d{2})?\s*(am|pm)?/i,/(\d{1,2})\s*(horas?|h)/i,/meio[\s-]dia/i,/meia[\s-]noite/i].some((e=>e.test(s)));let i,r;if(a)if(s.includes("hoje"))i=(new Date).toISOString().split("T")[0];else if(s.includes("amanhã")){const e=new Date;e.setDate(e.getDate()+1),i=e.toISOString().split("T")[0]}else{const e=s.match(/dia (\d{1,2})(\/|-)(\d{1,2})/i)||s.match(/(\d{1,2})(\/|-)(\d{1,2})/i);if(e){const s=parseInt(e[1]),a=parseInt(e[3]);i=`${(new Date).getFullYear()}-${a.toString().padStart(2,"0")}-${s.toString().padStart(2,"0")}`}}if(t){const e=s.match(/(\d{1,2})[h:.](\d{2})?\s*(am|pm)?/i)||s.match(/(\d{1,2})\s*(horas?|h)/i);if(e){const s=parseInt(e[1]),a=e[2]?parseInt(e[2]):0;r=`${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}else s.includes("meio-dia")||s.includes("meio dia")?r="12:00":(s.includes("meia-noite")||s.includes("meia noite"))&&(r="00:00")}let n=[/todos os dias/i,/cada dia/i,/diariamente/i,/toda[s]? (segunda|terça|quarta|quinta|sexta|sábado|domingo)/i,/toda semana/i,/semanalmente/i,/todo[s]? mês/i,/mensalmente/i,/rotina/i,/hábito/i,/prática/i,/contínuo/i,/regular/i].filter((e=>e.test(s))).length,l=[/reunião/i,/encontro/i,/call/i,/conversa com/i,/meeting/i,/entrevista/i,/apresentação/i,/discussão/i,/conferência/i,/videoconferência/i,/skype/i,/zoom/i,/teams/i,/google meet/i].filter((e=>e.test(s))).length,o=[/festa/i,/celebração/i,/aniversário/i,/evento/i,/casamento/i,/cerimônia/i,/formatura/i,/almoço com/i,/jantar com/i,/café com/i,/churrasco/i,/palestra/i,/show/i,/concerto/i,/teatro/i,/cinema/i].filter((e=>e.test(s))).length,c=1;a&&t?(l+=2,o+=2):a&&(o+=1,c+=1),n>0&&(n+=2);const d=[{type:"task",score:c},{type:"meeting",score:l},{type:"event",score:o},{type:"habit",score:n}];d.sort(((e,s)=>s.score-e.score));const m=d[0],h=d.reduce(((e,s)=>e+s.score),0),x=h>0?m.score/h:.5;return{type:m.type,confidence:x,date:i,time:r}})(i.title);e.confidence>.3&&(m(e.type),x(!0),r({...i,type:e.type,date:e.date||i.date,time:e.time||i.time})),p(!1)}),500);return()=>clearTimeout(e)}}),[i.title,u]);const v=e=>{r({...i,type:e}),m(e)};return e.jsx(R,{open:s,onOpenChange:t,children:e.jsxs(K,{className:"sm:max-w-[425px]",children:[e.jsxs(J,{children:[e.jsx(W,{children:"Adicionar Nova Atividade"}),e.jsx(G,{children:"Digite sua atividade e o sistema classificará automaticamente."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"title",className:"text-right",children:"Atividade"}),e.jsx(O,{id:"title",name:"title",className:"col-span-3",value:i.title,onChange:g,placeholder:"Ex: Almoço amanhã com pessoal do trabalho"})]}),h&&o&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("div",{className:"text-right text-sm text-gray-500",children:"Tipo detectado:"}),e.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[e.jsxs(Q,{className:`flex items-center gap-1 px-2 py-1 ${(e=>{switch(e){case"meeting":return"bg-indigo-100 text-indigo-800";case"task":return"bg-purple-100 text-purple-800";case"event":return"bg-green-100 text-green-800";case"habit":return"bg-amber-100 text-amber-800";default:return"bg-gray-100 text-gray-800"}})(o)}`,children:[(s=>{switch(s){case"meeting":return e.jsx(l,{className:"h-5 w-5 text-indigo-600"});case"task":return e.jsx(f,{className:"h-5 w-5 text-purple-600"});case"event":return e.jsx(j,{className:"h-5 w-5 text-green-600"});case"habit":return e.jsx(y,{className:"h-5 w-5 text-amber-600"});default:return e.jsx(a,{className:"h-5 w-5 text-gray-600"})}})(o),e.jsx("span",{children:(e=>{switch(e){case"meeting":return"Reunião";case"task":default:return"Tarefa";case"event":return"Evento";case"habit":return"Hábito"}})(o)})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(D,{variant:"outline",size:"sm",className:"h-7 w-7 p-0",onClick:()=>v("task"),title:"Marcar como Tarefa",children:e.jsx(f,{className:"h-4 w-4 text-purple-600"})}),e.jsx(D,{variant:"outline",size:"sm",className:"h-7 w-7 p-0",onClick:()=>v("meeting"),title:"Marcar como Reunião",children:e.jsx(l,{className:"h-4 w-4 text-indigo-600"})}),e.jsx(D,{variant:"outline",size:"sm",className:"h-7 w-7 p-0",onClick:()=>v("event"),title:"Marcar como Evento",children:e.jsx(j,{className:"h-4 w-4 text-green-600"})}),e.jsx(D,{variant:"outline",size:"sm",className:"h-7 w-7 p-0",onClick:()=>v("habit"),title:"Marcar como Hábito",children:e.jsx(y,{className:"h-4 w-4 text-amber-600"})})]})]})]}),i.date&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("div",{className:"text-right text-sm text-gray-500",children:"Data:"}),e.jsx("div",{className:"col-span-3 flex items-center",children:e.jsxs(Q,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),i.date,i.time&&` às ${i.time}`]})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"details",className:"text-right",children:"Detalhes"}),e.jsx(B,{id:"details",name:"details",className:"col-span-3",value:i.details,onChange:g,placeholder:"Adicione detalhes adicionais se necessário"})]})]}),e.jsx(V,{children:e.jsx(D,{type:"submit",onClick:n,children:"Salvar"})})]})})}function ye({onAddTask:s}){return e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-10 min-h-[calc(100vh-240px)]",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-purple-100 flex items-center justify-center mb-4",children:e.jsx(o,{className:"h-8 w-8 text-purple-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Nenhuma tarefa para hoje"}),e.jsx("p",{className:"text-gray-500 max-w-xs mb-6",children:"Adicione uma tarefa para começar seu dia e acompanhar seu progresso."}),e.jsxs(D,{onClick:s,className:"bg-purple-500 hover:bg-purple-600 text-white rounded-md px-4 py-2 flex items-center justify-center gap-2",children:[e.jsx(g,{className:"h-5 w-5"}),"Adicionar Sua Primeira Tarefa"]})]})}function ge({showCompleted:s,onShowCompletedChange:a}){return e.jsxs(E,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"flex items-center gap-1 text-gray-600",children:[e.jsx(v,{className:"h-4 w-4"}),"Filtrar"]})}),e.jsx(A,{className:"w-56",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Mostrar tarefas"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{id:"completed-tasks",checked:s,onCheckedChange:()=>a(!s)}),e.jsx("label",{htmlFor:"completed-tasks",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Incluir concluídas"})]})]})})]})}function ve({selectedDate:s,onPreviousDay:a,onNextDay:t}){const i=ie(s,"EEEE, d 'de' MMMM",{locale:re}),r=i.charAt(0).toUpperCase()+i.slice(1),n=ie(s,"yyyy-MM-dd")===ie(new Date,"yyyy-MM-dd");return e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(D,{variant:"ghost",size:"icon",onClick:a,className:"h-9 w-9 rounded-full",children:e.jsx(N,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"text-slate-500 font-medium",children:r}),!n&&e.jsx("span",{className:"text-xs text-slate-400",children:"Deslize para navegar entre os dias"})]}),e.jsx(D,{variant:"ghost",size:"icon",onClick:t,className:"h-9 w-9 rounded-full",children:e.jsx(w,{className:"h-5 w-5"})})]})}function Ne(e){switch(e){case"health":return"#34A853";case"business":return"#4285F4";case"finances":return"#FBBC04";case"spirituality":default:return"#9b87f5";case"family":return"#FF9500"}}function we(){const{shouldRefresh:e}=Y(),[s,a]=c.useState(!0),{selectedDate:t,setSelectedDate:i,goToNextDay:r,goToPreviousDay:n}=function(){const[e,s]=c.useState(new Date);return{selectedDate:e,setSelectedDate:s,goToNextDay:()=>{s((e=>ne(e,1)))},goToPreviousDay:()=>{s((e=>oe(e,1)))}}}(),{tasks:l,habits:o,isLoading:d,completedTasks:m,completedHabits:h,setCompletedTasks:x,setCompletedHabits:u,setTasks:p,setHabits:f,fetchTasks:j,fetchHabits:y}=function(e,s){const[a,t]=c.useState([]),[i,r]=c.useState([]),[n,l]=c.useState(!0),[o,d]=c.useState([]),[m,h]=c.useState([]),{toast:x}=S();c.useEffect((()=>{u(),p()}),[s,e]);const u=async()=>{try{l(!0);const{data:{user:s}}=await _.auth.getUser();if(!s)throw new Error("Usuário não autenticado");const{data:a,error:i}=await _.from("tasks").select("*").eq("user_id",s.id).eq("scheduled_date",ie(e,"yyyy-MM-dd"));if(i)throw i;const r=(null==a?void 0:a.filter((e=>e.completed)).map((e=>e.id)))||[];d(r);const n=(null==a?void 0:a.map((e=>({...e,duration:e.duration?String(e.duration):void 0,inbox_only:!1===e.scheduled}))))||[];t(n)}catch(s){x({variant:"destructive",title:"Erro",description:"Não foi possível carregar suas tarefas."})}finally{l(!1)}},p=async()=>{try{const{data:{user:s}}=await _.auth.getUser();if(!s)throw new Error("Usuário não autenticado");const{data:a,error:t}=await _.from("daily_routines").select("*").eq("user_id",s.id).eq("scheduled_date",ie(e,"yyyy-MM-dd"));if(t)throw t;const i=(null==a?void 0:a.filter((e=>e.completed)).map((e=>e.id)))||[];h(i);const n=(null==a?void 0:a.map((e=>({id:e.id,title:e.title,description:e.description,scheduled_date:e.scheduled_date,created_at:e.created_at,completed:e.completed||!1,category:e.category,frequency:e.frequency,streak_count:e.streak_count||0,duration:"30min",duration_days:e.duration_days,inbox_only:!1}))))||[];r(n)}catch(s){x({variant:"destructive",title:"Erro",description:"Não foi possível carregar seus hábitos."})}};return{tasks:a,habits:i,isLoading:n,completedTasks:o,completedHabits:m,setCompletedTasks:d,setCompletedHabits:h,setTasks:t,setHabits:r,fetchTasks:u,fetchHabits:p}}(t,e),{toggleTaskCompletion:g,toggleHabitCompletion:v,handleDeleteTask:N,handleDeleteHabit:w}=function(e,s,a,t,i,r){const{toast:n}=S();return{toggleTaskCompletion:async(s,a)=>{try{e((e=>a?e.filter((e=>e!==s)):[...e,s]));const{error:t}=await _.from("tasks").update({completed:!a}).eq("id",s);if(t)throw t;i()}catch(t){n({variant:"destructive",title:"Erro",description:"Não foi possível atualizar a tarefa."}),i()}},toggleHabitCompletion:async(e,a)=>{try{s((s=>a?s.filter((s=>s!==e)):[...s,e]));const{error:t}=await _.from("daily_routines").update({completed:!a}).eq("id",e);if(t)throw t;r()}catch(t){n({variant:"destructive",title:"Erro",description:"Não foi possível atualizar o hábito."}),r()}},handleDeleteTask:async e=>{try{const{error:s}=await _.from("tasks").delete().eq("id",e);if(s)throw s;a((s=>s.filter((s=>s.id!==e)))),n({title:"Tarefa excluída",description:"A tarefa foi removida com sucesso."})}catch(s){n({variant:"destructive",title:"Erro",description:"Não foi possível excluir a tarefa."})}},handleDeleteHabit:async e=>{try{const{error:s}=await _.from("daily_routines").delete().eq("id",e);if(s)throw s;t((s=>s.filter((s=>s.id!==e)))),n({title:"Hábito excluído",description:"O hábito foi removido com sucesso."})}catch(s){n({variant:"destructive",title:"Erro",description:"Não foi possível excluir o hábito."})}}}}(x,u,p,f,j,y),{showEditDialog:b,setShowEditDialog:k,currentItem:C,handleEditItem:T,saveItemChanges:D}=function(e,s,a,t){const[i,r]=c.useState(!1),[n,l]=c.useState(null),{toast:o}=S(),d=e=>({"5min":"5","15min":"15","30min":"30","45min":"45","1h":"60","1h30":"90","2h":"120",custom:"30"}[e]||"30");return{showEditDialog:i,setShowEditDialog:r,currentItem:n,handleEditItem:e=>{l(e),r(!0)},saveItemChanges:async e=>{if(n)try{if("task"===e.itemType){const a=d(e.duration||"30min"),t=!0===n.inbox_only,i=!1===e.inbox_only,{error:r}=await _.from("tasks").update({title:e.title,details:e.details,type:e.type,scheduled_date:e.scheduled_date,start_time:e.start_time,color:e.color,frequency:e.frequency||"once",notification_time:e.notification_time,duration:parseInt(a),scheduled:!e.inbox_only,location:e.location}).eq("id",e.id);if(r)throw r;if(t&&i||e.frequency&&"once"!==e.frequency){if(t||await he(e.id),!e.inbox_only&&e.frequency&&"once"!==e.frequency){const{data:{user:s}}=await _.auth.getUser();if(!s)throw new Error("Usuário não autenticado");const t=new Date(e.scheduled_date);let i=[];if("daily"===e.frequency?i=Array.from({length:30},((e,s)=>ie(ne(t,s+1),"yyyy-MM-dd"))):"weekly"===e.frequency?i=Array.from({length:12},((e,s)=>ie(ne(t,7*(s+1)),"yyyy-MM-dd"))):"monthly"===e.frequency&&(i=Array.from({length:6},((e,s)=>ie(le(t,s+1),"yyyy-MM-dd")))),i.length>0){const t=i.map((t=>({title:e.title,details:e.details,type:e.type,scheduled_date:t,start_time:e.start_time,color:e.color,frequency:e.frequency,notification_time:e.notification_time,duration:parseInt(a),completed:!1,user_id:s.id,priority:"medium",scheduled:!0,parent_task_id:e.id,location:e.location})));if(t.length>0){const{error:e}=await _.from("tasks").insert(t)}}}}else if(e.id){const s={title:e.title,details:e.details,type:e.type,color:e.color||n.color,frequency:e.frequency||"once",notification_time:e.notification_time,duration:parseInt(a),location:e.location};await me(e.id,s)}if(e.subtasks&&e.subtasks.length>0){const{error:s}=await _.from("subtasks").delete().eq("task_id",e.id),a=e.subtasks.map(((s,a)=>({task_id:e.id,title:s,completed:!1,order_index:a}))),{error:t}=await _.from("subtasks").insert(a)}s((s=>s.map((s=>s.id===e.id?{...s,title:e.title,details:e.details,type:e.type,scheduled_date:e.scheduled_date,start_time:e.start_time,color:e.color||s.color,frequency:e.frequency||"once",notification_time:e.notification_time,duration:a,inbox_only:e.inbox_only,location:e.location}:s))))}else{const s=e.duration_days||21;n.inbox_only,e.inbox_only;let a={title:e.title,description:e.details,frequency:e.frequency||e.category,scheduled_date:e.scheduled_date,start_time:e.start_time,duration_days:s,color:e.color,notification_time:e.notification_time,scheduled:!e.inbox_only};e.duration&&(a.duration=parseInt(d(e.duration)));const{error:i}=await _.from("daily_routines").update(a).eq("id",e.id);if(i)throw i;t((a=>a.map((a=>a.id===e.id?{...a,title:e.title,description:e.details,frequency:e.frequency||a.frequency,scheduled_date:e.scheduled_date,start_time:e.start_time,duration_days:s,color:e.color||a.color,notification_time:e.notification_time,duration:e.duration,inbox_only:e.inbox_only}:a))))}r(!1),!1===e.inbox_only&&!0===n.inbox_only?o({title:"task"===e.itemType?"Tarefa confirmada":"Hábito confirmado",description:e.frequency&&"once"!==e.frequency?"Item enviado para o Planner e repetições criadas para os próximos períodos.":"Item enviado para o Planner."}):o({title:"task"===e.itemType?"Tarefa atualizada":"Hábito atualizado",description:"As alterações foram salvas com sucesso."})}catch(a){o({variant:"destructive",title:"Erro",description:"Não foi possível salvar as alterações."})}}}}(0,p,0,f),{showAddDialog:M,setShowAddDialog:q,newTaskData:O,setNewTaskData:E,isTaskTypeSelectorOpen:I,setIsTaskTypeSelectorOpen:A,isMeetingModalOpen:H,setIsMeetingModalOpen:F,isTaskModalOpen:z,setIsTaskModalOpen:P,isEventModalOpen:U,setIsEventModalOpen:L,isHabitModalOpen:$,setIsHabitModalOpen:B,handleAddTask:V,saveNewTask:R}=function(e){const[s,a]=c.useState(!1),[t,i]=c.useState({title:"",details:"",type:"task",date:"",time:""}),[r,n]=c.useState(!1),[l,o]=c.useState(!1),[d,m]=c.useState(!1),[h,x]=c.useState(!1),[u,p]=c.useState(!1),{toast:f}=S();return{showAddDialog:s,setShowAddDialog:a,newTaskData:t,setNewTaskData:i,isTaskTypeSelectorOpen:r,setIsTaskTypeSelectorOpen:n,isMeetingModalOpen:l,setIsMeetingModalOpen:o,isTaskModalOpen:d,setIsTaskModalOpen:m,isEventModalOpen:h,setIsEventModalOpen:x,isHabitModalOpen:u,setIsHabitModalOpen:p,handleAddTask:()=>{i({title:"",details:"",type:"task",date:"",time:""}),a(!0)},saveNewTask:async()=>{try{const{data:{user:s}}=await _.auth.getUser();if(!s)return void f({title:"Erro",description:"Você precisa estar logado para criar uma tarefa.",variant:"destructive"});if(!t.title.trim())return void f({title:"Erro",description:"O título da tarefa é obrigatório.",variant:"destructive"});let i=null;if(i=t.date?t.date:(new Date).toISOString().split("T")[0],"habit"===t.type){const{error:e}=await _.from("daily_routines").insert({user_id:s.id,title:t.title,description:t.details,scheduled_date:i,start_time:t.time||null,frequency:"daily",completed:!1,category:"habit"});if(e)throw e;f({title:"Hábito adicionado",description:"O hábito foi adicionado com sucesso!"})}else{const{error:e}=await _.from("tasks").insert({user_id:s.id,title:t.title,details:t.details,type:t.type,status:"pending",scheduled_date:i,start_time:t.time||null});if(e)throw e;f({title:"Atividade adicionada",description:"A atividade foi adicionada com sucesso!"})}a(!1);const{data:r}=await _.from("tasks").select("*").eq("user_id",s.id).order("scheduled_date",{ascending:!0});r&&e(r)}catch(s){f({title:"Erro",description:"Ocorreu um erro ao criar a atividade. Tente novamente.",variant:"destructive"})}}}}(p),K=function(e,s,a,t){return[...e.map((e=>({...e,itemType:"task",isCompleted:a.includes(e.id)}))),...s.map((e=>({...e,itemType:"habit",isCompleted:t.includes(e.id),details:e.description||"",type:"routine",color:Ne(e.category||"health"),duration:"number"==typeof e.duration?String(e.duration):e.duration||void 0})))].sort(((e,s)=>e.isCompleted!==s.isCompleted?e.isCompleted?1:-1:new Date(s.created_at).getTime()-new Date(e.created_at).getTime()))}(l,o,m,h);var J;return{isLoading:d,filteredItems:(J=K,s?J:J.filter((e=>!e.isCompleted))),showCompletedTasks:s,setShowCompletedTasks:a,showEditDialog:b,setShowEditDialog:k,currentItem:C,handleEditItem:T,saveItemChanges:D,showAddDialog:M,setShowAddDialog:q,newTaskData:O,setNewTaskData:E,isTaskTypeSelectorOpen:I,setIsTaskTypeSelectorOpen:A,isMeetingModalOpen:H,setIsMeetingModalOpen:F,isTaskModalOpen:z,setIsTaskModalOpen:P,isEventModalOpen:U,setIsEventModalOpen:L,isHabitModalOpen:$,setIsHabitModalOpen:B,fetchTasks:j,fetchHabits:y,toggleTaskCompletion:g,toggleHabitCompletion:v,handleAddTask:V,handleDeleteTask:N,handleDeleteHabit:w,saveNewTask:R,selectedDate:t,setSelectedDate:i,goToNextDay:r,goToPreviousDay:n}}function be(){const{isLoading:s,filteredItems:a,showCompletedTasks:t,setShowCompletedTasks:i,showEditDialog:r,setShowEditDialog:n,currentItem:l,handleEditItem:o,saveItemChanges:d,showAddDialog:m,setShowAddDialog:h,newTaskData:x,setNewTaskData:u,isTaskTypeSelectorOpen:p,setIsTaskTypeSelectorOpen:f,isMeetingModalOpen:j,setIsMeetingModalOpen:y,isTaskModalOpen:v,setIsTaskModalOpen:N,isEventModalOpen:w,setIsEventModalOpen:_,isHabitModalOpen:C,setIsHabitModalOpen:S,toggleTaskCompletion:T,toggleHabitCompletion:M,handleDeleteTask:q,handleDeleteHabit:O,saveNewTask:E,selectedDate:I,goToNextDay:A,goToPreviousDay:H}=we(),[F,z]=c.useState(!1);c.useEffect((()=>()=>{n(!1),h(!1),f(!1),y(!1),N(!1),_(!1),S(!1)}),[]);const P=b({onSwipedLeft:()=>A(),onSwipedRight:()=>H(),preventScrollOnSwipe:!0,trackMouse:!1,swipeDuration:500,delta:50}),U=(e,s,a)=>{"task"===a?T(e,s):M(e,s)},L=(e,s)=>{"task"===s?q(e):O(e)},$=()=>{z(!0)};return e.jsxs("div",{className:"p-4 pb-safe bg-gradient-to-b from-purple-50 to-white min-h-screen",children:[e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("div",{className:"flex flex-col items-start gap-1 mb-3 py-0 px-[21px] mx-0 my-[11px]",children:e.jsxs("h1",{className:"font-bold text-slate-800 flex items-center gap-2 bg-gradient-to-r from-purple-700 to-indigo-700 bg-clip-text text-transparent text-2xl text-center mx-[31px]",children:[e.jsx(k,{className:"h-8 w-8 text-purple-500",strokeWidth:2}),"Atividade de Hoje"]})}),e.jsx("div",{className:"px-[21px] mb-4",children:e.jsx(ve,{selectedDate:I,onPreviousDay:H,onNextDay:A})}),e.jsxs("div",{...P,className:"transition-all duration-300 ease-in-out",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 px-[21px]",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ge,{showCompleted:t,onShowCompletedChange:i}),a.length>0&&e.jsx(de,{})]}),e.jsxs(D,{onClick:$,size:"sm",className:"flex items-center gap-1",children:[e.jsx(g,{className:"h-4 w-4"}),"Nova Tarefa"]})]}),s?e.jsx("div",{className:"space-y-3 animate-pulse px-[21px]",children:[1,2,3].map((s=>e.jsx("div",{className:"h-20 bg-gray-100 rounded-xl"},s)))}):a.length>0?e.jsx("div",{className:"space-y-3 min-h-[calc(100vh-240px)] px-[21px]",children:a.map((s=>e.jsx(xe,{item:s,onToggleCompletion:U,onEdit:o,onDelete:L},`${s.itemType}-${s.id}`)))}):e.jsx("div",{className:"px-[30px]",children:e.jsx(ye,{onAddTask:$})})]})]}),e.jsx(fe,{open:r,onOpenChange:n,item:l,onSave:d}),e.jsx(je,{open:m,onOpenChange:h,taskData:x,onTaskDataChange:u,onSave:E}),e.jsx(X,{isOpen:F,onOpenChange:z,onSuccess:()=>{}})]})}export{be as default};

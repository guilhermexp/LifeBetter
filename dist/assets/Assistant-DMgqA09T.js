import{r as e,aK as a,aL as s,H as t,aM as r,aN as o,j as n,z as i,N as c,az as l,aD as d,ar as m,E as u,aj as p,cj as h,ck as g,aw as f,R as x,cl as v,bS as y,cm as b,aC as j,cn as w,co as N,cp as S,cq as k,cr as T}from"./vendor-react-Bu_1CUKu.js";import{s as C,u as _,z as I,B as $,q,F as D,W as A,G as P,J as E}from"./index-QnHMPHoX.js";import{u as O,a as R}from"./useAreaProgress-C4N6BS3s.js";import{C as M,a as z,g as L,h as V,b as B,T as F,d as H,e as U,f as G}from"./card-BnqYcvPQ.js";import{P as Q,S as J}from"./skeleton-DzSR_xWs.js";import{S as W}from"./separator-B-xoOM7X.js";import"./vendor-CaMlX_x-.js";import"./vendor-date-fns-BCWkNTJO.js";function K(){var a,s,t;const{user:r}=_(),[o,d]=e.useState("Olá"),{refresh:m}=I(),u=(null==(a=null==r?void 0:r.profile)?void 0:a.full_name)||(null==(s=null==r?void 0:r.profile)?void 0:s.username)||(null==(t=null==r?void 0:r.email)?void 0:t.split("@")[0])||"Usuário";return e.useEffect((()=>{const e=(new Date).getHours();d(e<12?"Bom dia":e<18?"Boa tarde":"Boa noite")}),[]),n.jsxs("div",{className:"p-4 rounded-2xl bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg mb-6 relative",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:"p-2 bg-white bg-opacity-20 rounded-full",children:n.jsx(i,{className:"h-6 w-6"})}),n.jsx("h1",{className:"text-xl font-bold",children:"Assistente IA"}),n.jsxs($,{variant:"ghost",size:"sm",className:"ml-auto bg-white/10 hover:bg-white/20 text-white",onClick:m,children:[n.jsx(c,{className:"h-4 w-4 mr-1"}),"Atualizar"]})]}),n.jsxs("p",{className:"text-white text-opacity-90 mb-3 pl-12",children:[o,", ",n.jsx("span",{className:"font-semibold",children:u}),"! Estou monitorando sua rotina e hábitos para ajudar você a melhorar seu progresso em cada área da vida."]}),n.jsxs("div",{className:"bg-white bg-opacity-10 p-3 rounded-lg flex items-center gap-3 pl-12",children:[n.jsx(l,{className:"h-5 w-5 text-yellow-300 flex-shrink-0"}),n.jsx("p",{className:"text-sm",children:"Com base na sua rotina recente, tenho insights importantes para compartilhar."})]})]})}function X({insights:e}){const a=e=>{switch(e){case"progress":return n.jsx(g,{className:"h-5 w-5 text-green-500"});case"decline":return n.jsx(h,{className:"h-5 w-5 text-red-500"});case"consistency":return n.jsx(p,{className:"h-5 w-5 text-blue-500"});case"achievement":return n.jsx(u,{className:"h-5 w-5 text-yellow-500"});case"warning":return n.jsx(m,{className:"h-5 w-5 text-amber-500"});default:return n.jsx(i,{className:"h-5 w-5 text-purple-500"})}},s=e=>{switch(e){case"progress":return"bg-green-100 text-green-800";case"decline":return"bg-red-100 text-red-800";case"consistency":return"bg-blue-100 text-blue-800";case"achievement":return"bg-yellow-100 text-yellow-800";case"warning":return"bg-amber-100 text-amber-800";default:return"bg-purple-100 text-purple-800"}};return 0===e.length?n.jsxs(M,{children:[n.jsxs(z,{children:[n.jsxs(L,{className:"flex items-center gap-2",children:[n.jsx(i,{className:"h-5 w-5 text-purple-500"}),"Insights do Assistente IA"]}),n.jsx(V,{children:"Análise inteligente da sua rotina e hábitos"})]}),n.jsx(B,{children:n.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[n.jsx(i,{className:"h-12 w-12 text-gray-300 mb-3"}),n.jsx("p",{className:"text-gray-500",children:"Ainda não temos insights suficientes para análise."}),n.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Continue usando o app para receber recomendações personalizadas."})]})})]}):n.jsxs(M,{children:[n.jsxs(z,{children:[n.jsxs(L,{className:"flex items-center gap-2",children:[n.jsx(i,{className:"h-5 w-5 text-purple-500"}),"Insights do Assistente IA"]}),n.jsx(V,{children:"Análise inteligente da sua rotina e hábitos"})]}),n.jsx(B,{children:n.jsx("ul",{className:"space-y-4",children:e.map(((e,t)=>n.jsx("li",{className:"p-4 bg-white rounded-lg border border-gray-100 shadow-sm hover:shadow-md transition-shadow",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"p-2 bg-gray-50 rounded-full",children:a(e.type)}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-medium",children:e.title}),n.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${s(e.type)}`,children:e.area})]}),n.jsx("p",{className:"text-sm text-gray-600",children:e.description}),e.action&&n.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Sugestão de ação:"}),n.jsxs($,{variant:"ghost",size:"sm",className:"text-xs flex items-center gap-1 text-purple-600 hover:text-purple-700 hover:bg-purple-50",onClick:()=>{const e=document.querySelector('[data-value="habits"]');e&&e instanceof HTMLElement&&(e.click(),setTimeout((()=>{e.scrollIntoView({behavior:"smooth"})}),100))},children:["Ver Hábitos",n.jsx(d,{className:"h-3 w-3 ml-1"})]})]}),n.jsx("p",{className:"text-xs text-gray-600 mt-1",children:e.action})]})]})]})},t)))})})]})}function Y({data:e,compact:i=!1}){const c=e=>{switch(e){case"health":default:return n.jsx(a,{className:"h-4 w-4"});case"business":return n.jsx(o,{className:"h-4 w-4"});case"finances":return n.jsx(r,{className:"h-4 w-4"});case"family":return n.jsx(t,{className:"h-4 w-4"});case"spirituality":return n.jsx(s,{className:"h-4 w-4"})}};return n.jsxs(M,{className:"hover:shadow-md transition-shadow",children:[n.jsxs(z,{className:i?"px-4 py-3":void 0,children:[n.jsxs(L,{className:"flex items-center gap-2",children:[n.jsx(g,{className:"h-5 w-5 text-purple-500"}),"Resumo de Progresso"]}),!i&&n.jsx(V,{children:"Visão geral do seu progresso nas áreas da vida"})]}),n.jsx(B,{className:i?"px-4 py-3":void 0,children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-green-50 rounded-lg p-3 hover:bg-green-100 transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:n.jsx(g,{className:"h-4 w-4 text-green-600"})}),n.jsxs("div",{children:[n.jsxs("p",{className:(i?"text-base":"text-lg")+" font-semibold text-green-700",children:[e.topAreaProgress,"%"]}),n.jsx("p",{className:"text-xs text-green-800",children:"Maior Progresso"})]})]}),n.jsx("p",{className:"mt-1 text-xs text-green-700",children:e.topAreaName})]}),n.jsxs("div",{className:"bg-amber-50 rounded-lg p-3 hover:bg-amber-100 transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"p-2 bg-amber-100 rounded-full",children:n.jsx(h,{className:"h-4 w-4 text-amber-600"})}),n.jsxs("div",{children:[n.jsxs("p",{className:(i?"text-base":"text-lg")+" font-semibold text-amber-700",children:[e.lowestAreaProgress,"%"]}),n.jsx("p",{className:"text-xs text-amber-800",children:"Menor Progresso"})]})]}),n.jsx("p",{className:"mt-1 text-xs text-amber-700",children:e.lowestAreaName}),n.jsxs($,{variant:"ghost",size:"sm",className:"text-xs flex items-center gap-1 text-amber-700 hover:text-amber-800 hover:bg-amber-200 mt-1 px-2 py-1 h-auto",onClick:()=>{const e=document.querySelector('[data-value="habits"]');e&&e instanceof HTMLElement&&(e.click(),setTimeout((()=>{e.scrollIntoView({behavior:"smooth"})}),100))},children:["Ver recomendações",n.jsx(d,{className:"h-3 w-3 ml-1"})]})]})]}),!i&&n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium mb-3",children:"Progresso por Área"}),n.jsx("div",{className:"space-y-4",children:e.allAreasProgress.map(((a,s)=>n.jsxs("div",{className:"hover:bg-gray-50 p-2 rounded-lg transition-colors",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`${a.color} text-white p-1 rounded-md`,children:c(a.areaType)}),n.jsx("span",{className:"text-sm font-medium",children:a.name})]}),n.jsxs("span",{className:"text-sm",children:[a.progress,"%"]})]}),n.jsx(Q,{value:a.progress,className:"h-2",indicatorClassName:a.gradient}),n.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1 mb-3",children:[n.jsxs("span",{children:[a.tasks_completed," tarefas concluídas"]}),n.jsxs("span",{children:[a.tasks_pending," pendentes"]})]}),s<e.allAreasProgress.length-1&&n.jsx(W,{className:"my-2"})]},s)))})]}),i&&e.allAreasProgress.length>0&&n.jsxs("div",{children:[n.jsx("h4",{className:"text-xs font-medium mb-2",children:"Áreas Principais"}),n.jsx("div",{className:"space-y-2",children:e.allAreasProgress.slice(0,3).map(((e,a)=>n.jsxs("div",{className:"hover:bg-gray-50 p-1.5 rounded-lg transition-colors",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("div",{className:`${e.color} text-white p-1 rounded-md`,children:c(e.areaType)}),n.jsx("span",{className:"text-xs font-medium",children:e.name})]}),n.jsxs("span",{className:"text-xs",children:[e.progress,"%"]})]}),n.jsx(Q,{value:e.progress,className:"h-1.5",indicatorClassName:e.gradient})]},a)))})]})]})})]})}function Z({recommendations:i}){const{toast:c}=q(),[l,d]=e.useState(new Set);if(0===i.length)return null;const m=e=>{switch(e){case"health":default:return n.jsx(a,{className:"h-4 w-4"});case"business":return n.jsx(o,{className:"h-4 w-4"});case"finances":return n.jsx(r,{className:"h-4 w-4"});case"family":return n.jsx(t,{className:"h-4 w-4"});case"spirituality":return n.jsx(s,{className:"h-4 w-4"})}};return n.jsxs("div",{className:"space-y-4",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Sugestões Personalizadas"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map(((e,a)=>n.jsx("div",{className:`rounded-xl p-4 ${e.bgColor} bg-opacity-10 border ${e.borderColor} hover:shadow-md transition-shadow`,children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:`p-2 rounded-md ${e.color} text-white`,children:m(e.areaType)}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"font-medium text-sm mb-1",children:e.title}),n.jsx("p",{className:"text-xs text-gray-600 mb-3",children:e.description}),n.jsx("div",{className:"space-y-2",children:e.items.map(((s,t)=>{const r=`${e.areaType}-${a}-${t}`,o=l.has(r);return n.jsxs("div",{className:"flex items-center gap-2 bg-white bg-opacity-60 p-2 rounded-md text-xs hover:bg-opacity-80 transition-colors",children:[n.jsx($,{size:"icon",variant:"outline",disabled:o,className:"h-5 w-5 rounded-full",onClick:()=>(async(e,a,s,t)=>{try{d((e=>new Set(e).add(t)));const{data:{user:r}}=await C.auth.getUser();if(!r)return void c({variant:"destructive",title:"Erro",description:"Você precisa estar logado para adicionar hábitos."});const o=(new Date).toISOString().split("T")[0],{error:n}=await C.from("daily_routines").insert({title:e,description:a||`Hábito recomendado para melhorar sua área de ${s}`,user_id:r.id,category:s,frequency:"daily",scheduled_date:o,start_time:"08:00:00"});if(n)throw n;c({title:"Hábito adicionado!",description:`${e} foi adicionado à sua rotina.`})}catch(r){c({variant:"destructive",title:"Erro",description:"Não foi possível adicionar o hábito. Tente novamente."})}finally{d((e=>{const a=new Set(e);return a.delete(t),a}))}})(s,"",e.areaType,r),children:n.jsx(f,{className:"h-3 w-3"})}),n.jsx("span",{className:"flex-1",children:s}),o&&n.jsx("span",{className:"text-xs text-gray-500 animate-pulse",children:"Adicionando..."})]},t)}))})]})]})},a)))})]})}function ee({recommendation:e,onRefresh:a,compact:s=!1}){const{toast:t}=q(),[r,o]=x.useState(!1);return n.jsx(M,{className:"overflow-hidden hover:shadow-md transition-shadow",children:n.jsx(B,{className:"p-0",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:`${e.areaColor} p-2 text-white flex items-center gap-2`,children:[n.jsx(e.areaIcon,{className:"h-4 w-4"}),n.jsx("span",{className:"text-sm font-medium",children:e.areaName})]}),n.jsxs("div",{className:s?"p-3":"p-4",children:[n.jsx("h4",{className:`font-semibold ${s?"text-sm":""} mb-1`,children:e.title}),s?n.jsx("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2",children:e.description}):n.jsx("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded-full",children:e.frequency}),n.jsxs($,{variant:"outline",size:"sm",onClick:async()=>{try{o(!0);const{data:{user:s}}=await C.auth.getUser();if(!s)return void t({variant:"destructive",title:"Erro",description:"Você precisa estar logado para adicionar hábitos."});const r=(new Date).toISOString().split("T")[0];let n;switch(e.areaType){case"health":n="health";break;case"business":n="business";break;case"growth":default:n="growth";break;case"relationships":n="relationships"}const{error:i}=await C.from("daily_routines").insert({title:e.title,description:e.description,user_id:s.id,category:n,frequency:"Diariamente"===e.frequency?"daily":e.frequency.includes("semana")?"weekly":"monthly",scheduled_date:r,start_time:"08:00:00"});if(i)throw i;t({title:"Hábito adicionado!",description:`${e.title} foi adicionado à sua rotina.`}),a()}catch(s){t({variant:"destructive",title:"Erro",description:"Não foi possível adicionar o hábito. Tente novamente."})}finally{o(!1)}},disabled:r,className:"flex items-center gap-1 "+(s?"text-xs px-2 py-1 h-7":""),children:[n.jsx(f,{className:""+(s?"h-3 w-3":"h-3.5 w-3.5")}),r?"Adicionando...":"Adicionar"]})]})]})]})})})}const ae=({isOffline:e,isSpeaking:a=!1,onToggleSpeech:s})=>n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(i,{className:"h-5 w-5"}),n.jsx(L,{className:"text-lg",children:"Assistente de Agenda"}),e&&n.jsxs("div",{className:"flex items-center ml-2 text-yellow-200 text-xs bg-purple-700 px-2 py-1 rounded-full",children:[n.jsx(v,{className:"h-3 w-3 mr-1"}),n.jsx("span",{children:"Offline"})]}),a&&n.jsxs("div",{className:"flex items-center ml-2 text-green-200 text-xs bg-purple-700 px-2 py-1 rounded-full",children:[n.jsx(y,{className:"h-3 w-3 mr-1 animate-pulse"}),n.jsx("span",{children:"Falando"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(V,{className:"text-purple-100 m-0",children:"Adicione eventos e tarefas por voz ou texto"}),s&&n.jsx("button",{onClick:s,className:"p-1 rounded-full hover:bg-purple-500 transition-colors",title:a?"Mudo":"Com som",children:a?n.jsx(y,{className:"h-4 w-4 text-white"}):n.jsx(b,{className:"h-4 w-4 text-white"})})]})]}),se=({messages:a})=>{const s=e.useRef(null);return e.useEffect((()=>{s.current&&s.current.scrollIntoView({behavior:"smooth"})}),[a]),n.jsxs("div",{id:"assistant-messages",className:"max-h-60 overflow-y-auto p-4 space-y-3",children:[a.map(((e,a)=>n.jsx("div",{className:"flex "+("assistant"===e.role?"justify-start":"justify-end"),children:n.jsx("div",{className:"max-w-[80%] rounded-lg p-3 "+("assistant"===e.role?"bg-purple-100 text-purple-900":"bg-gray-100 text-gray-900"),dangerouslySetInnerHTML:{__html:e.content.replace(/\*([^*]+)\*/g,"<strong>$1</strong>").replace(/\n/g,"<br />")}})},a))),n.jsx("div",{ref:s})]})},te=({onTranscription:a,setIsRecording:s,disabled:t=!1})=>{const[r,o]=e.useState(!1),[i,c]=e.useState(!1),l=e.useRef(null),d=e.useRef([]),{toast:m}=q(),u=async()=>{try{c(!0);const e=new Blob(d.current,{type:"audio/webm"}),s=new FileReader;s.readAsDataURL(e),s.onloadend=async()=>{var e;try{const t=null==(e=s.result)?void 0:e.split(",")[1],{data:r,error:o}=await C.functions.invoke("voice-to-text",{body:{audio:t}});if(o)throw o;if(!r.text||"string"!=typeof r.text)throw new Error("Falha na transcrição");m({title:"Áudio transcrito",description:r.text.slice(0,50)+(r.text.length>50?"...":"")}),a(r.text)}catch(t){m({variant:"destructive",title:"Erro ao processar áudio",description:"Não foi possível transcrever seu áudio. Tente novamente."})}finally{c(!1)}}}catch(e){c(!1),m({variant:"destructive",title:"Erro ao processar áudio",description:"Ocorreu um erro inesperado."})}};return n.jsx("div",{children:i?n.jsx($,{disabled:!0,variant:"outline",size:"icon",className:"h-10 w-10 rounded-full",children:n.jsx(j,{className:"h-5 w-5 animate-spin"})}):r?n.jsx($,{onClick:()=>{if(l.current&&r){l.current.stop();l.current.stream.getTracks().forEach((e=>e.stop())),o(!1),s&&s(!1)}},variant:"destructive",size:"icon",className:"h-10 w-10 rounded-full",disabled:t,children:n.jsx(w,{className:"h-5 w-5"})}):n.jsx($,{onClick:async()=>{try{d.current=[];const e=await navigator.mediaDevices.getUserMedia({audio:!0}),a=new MediaRecorder(e);l.current=a,a.ondataavailable=e=>{e.data.size>0&&d.current.push(e.data)},a.onstop=u,a.start(),o(!0),s&&s(!0),m({title:"Gravação iniciada",description:"Fale o que deseja adicionar à sua agenda"})}catch(e){m({variant:"destructive",title:"Erro ao iniciar gravação",description:"Verifique se o acesso ao microfone está permitido."})}},variant:"outline",size:"icon",className:"h-10 w-10 rounded-full hover:bg-red-100 hover:text-red-600 border-dashed",disabled:t,children:n.jsx(N,{className:"h-5 w-5"})})})},re=({isProcessing:e,isRecording:a,setIsRecording:s,onTranscription:t,onSendClick:r,onTextInput:o,inputRef:i})=>n.jsxs("div",{className:"p-3 border-t flex items-center gap-2",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx("input",{ref:i,type:"text",placeholder:e?"Processando...":"Digite uma mensagem...",className:"w-full pl-10 pr-4 py-2 rounded-full border border-gray-300 focus:border-purple-500 focus:ring-1 focus:ring-purple-500 outline-none",onKeyDown:o,disabled:a||e}),n.jsx(S,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),n.jsx($,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full text-purple-600 hover:bg-purple-100",onClick:r,disabled:e||a,children:e?n.jsx(j,{className:"h-5 w-5 animate-spin"}):n.jsx(k,{className:"h-5 w-5"})}),n.jsx(te,{onTranscription:t,setIsRecording:s,disabled:e}),n.jsx($,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full text-purple-600 hover:bg-purple-100",onClick:()=>window.location.href="/planner",children:n.jsx(p,{className:"h-5 w-5"})})]}),oe=()=>n.jsxs(D,{variant:"destructive",className:"m-3 bg-red-50 text-red-700 border-red-200",children:[n.jsxs(A,{className:"flex items-center gap-2",children:[n.jsx(v,{className:"h-4 w-4"}),"Modo Offline"]}),n.jsx(P,{children:"O assistente está com problemas de conexão. Algumas funcionalidades podem estar limitadas, mas você ainda pode adicionar eventos básicos."})]}),ne=({isRetrying:e,onRetry:a})=>n.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-center",children:n.jsx($,{variant:"outline",size:"sm",className:"text-purple-600 border border-purple-200 hover:bg-purple-50",onClick:a,disabled:e,children:e?n.jsxs(n.Fragment,{children:[n.jsx(j,{className:"h-4 w-4 mr-2 animate-spin"}),"Conectando..."]}):n.jsxs(n.Fragment,{children:[n.jsx(T,{className:"h-4 w-4 mr-2"}),"Tentar reconectar"]})})}),ie=(a={})=>{const[s,t]=e.useState(!1),[r,o]=e.useState(!1),[n,i]=e.useState(null),c=e.useRef(null),l=a.voiceId||"EXAVITQu4vr4xnSDxMaL",d=a.modelId||"eleven_multilingual_v2",m=()=>{c.current&&(c.current.pause(),c.current.currentTime=0,t(!1))};return{speak:async e=>{try{if(!e||""===e.trim())return;m(),o(!0),i(null);const{data:a,error:s}=await C.functions.invoke("text-to-speech",{body:{text:e,voiceId:l,modelId:d}});if(s)return i("Erro ao converter texto para fala"),void o(!1);if(!(null==a?void 0:a.audioContent))return i("Resposta inválida do serviço de texto para fala"),void o(!1);const r=(c.current||(c.current=new Audio,c.current.onended=()=>t(!1),c.current.onerror=()=>{t(!1),i("Erro ao reproduzir áudio")}),c.current);r.src=`data:audio/mpeg;base64,${a.audioContent}`,o(!1),t(!0),r.play()}catch(a){i("Erro ao processar texto para fala"),o(!1)}},stopSpeech:m,isSpeaking:s,isLoading:r,error:n}},ce=()=>{const[a,s]=e.useState([{role:"assistant",content:"Olá! Sou seu assistente de agenda. Posso ajudar você a adicionar eventos, tarefas e lembrar de compromissos. Como posso ajudar hoje?",shouldSpeak:!0}]),{speak:t,stopSpeech:r,isSpeaking:o}=ie(),n=e.useRef("");return{messages:a,setMessages:s,addUserMessage:e=>{o&&r(),s((a=>[...a,{role:"user",content:e}]))},addAssistantMessage:(e,a=!0)=>{n.current=e,s((s=>[...s,{role:"assistant",content:e,shouldSpeak:a}])),a&&t(e)},isSpeaking:o,stopSpeech:r}},le=async()=>{try{const a=new AbortController,s=setTimeout((()=>a.abort()),5e3);try{const e=await fetch("https://www.google.com",{method:"GET",signal:a.signal,mode:"no-cors"}).catch((()=>null));return clearTimeout(s),!!e}catch(e){return!1}}catch(e){return!1}},de=["Desculpe, estou com problemas de conexão no momento. Você pode adicionar eventos manualmente clicando no ícone de calendário.","Parece que estou offline. Posso ajudar com tarefas básicas como adicionar eventos ao calendário.","Não consegui conectar ao serviço de IA. Tente novamente mais tarde ou use o botão de calendário para adicionar eventos.","Estou temporariamente indisponível para processar solicitações complexas. Tente usar comandos mais simples ou adicione eventos manualmente.","A conexão com o servidor está instável. Que tal adicionar sua tarefa diretamente no calendário?"],me=e=>{const a=e.match(/\b(hoje|amanhã|segunda|terça|quarta|quinta|sexta|sábado|domingo|(\d{1,2})[\/\-\.](\d{1,2})(?:[\/\-\.](\d{2,4}))?)\b/i),s=e.match(/\b(\d{1,2})[:\.](\d{2})(?:\s*(?:horas?|h))?\b|\b(\d{1,2})\s*(?:horas?|h)\b|meio[\s-]dia|meia[\s-]noite/i),t=e.match(/\bem\s+([^,\.;]+)|\bno\s+([^,\.;]+)|\bna\s+([^,\.;]+)/i);let r=e.split(/\s+(?:em|no|na|para|às|as|ao|dia)\s+/)[0].trim();const o=e.match(/\b(almoço|jantar|café)(?:\s+(?:com|para))?\s+(?:(?:os|as)\s+)?(pais|família|parentes|avós|primos|tios)\s+d[aeo]\s+([A-Z][a-zÀ-ú]+)/i);if(o){const[e,a,s,t]=o;r=`${a} com ${s} de ${t}`}let n=s?s[0]:null;!n&&e.toLowerCase().includes("almoço")?n="12:30":!n&&e.toLowerCase().includes("jantar")?n="20:00":!n&&e.toLowerCase().includes("café")&&(n="09:00");let i=null;return t&&(i=(t[1]||t[2]||t[3]).trim()),{title:r||"Novo compromisso",date:a?a[0]:null,time:n,location:i}},ue=(a,s)=>{const[t,r]=e.useState(null),[o,n]=e.useState(!1),{setMessages:i}=ce();return{pendingTaskConfirmation:t,setPendingTaskConfirmation:r,awaitingConfirmation:o,setAwaitingConfirmation:n,handleConfirmationResponse:async e=>{if(!t)return;const o=e.toLowerCase(),c=["sim","yes","confirmar","confirmo","ok","certo","pode","correto","adicionar"].some((e=>o.includes(e))),l=["não","nao","no","cancela","cancelar","errado","incorreto"].some((e=>o.includes(e)));if(c){const e=await(async(e,a,s,t,r,o)=>{try{a(!0);const{data:{user:n}}=await C.auth.getUser();if(!n)return s((e=>[...e,{role:"assistant",content:"Você precisa estar logado para adicionar tarefas. Por favor, faça login e tente novamente."}])),!1;const{error:i}=await C.from("tasks").insert({user_id:n.id,title:e.title,scheduled_date:e.date||(new Date).toISOString().split("T")[0],start_time:e.time||null,location:e.location||null,status:"pending",type:"task"});return i?(s((e=>[...e,{role:"assistant",content:"Ocorreu um erro ao adicionar a tarefa. Por favor, tente novamente."}])),!1):(t(null),r(!1),o(),!0)}catch(n){return s((e=>[...e,{role:"assistant",content:"Ocorreu um erro ao adicionar a tarefa. Por favor, tente novamente."}])),!1}finally{a(!1)}})(t,a,i,r,n,s);e&&i((e=>[...e,{role:"assistant",content:"Tarefa adicionada com sucesso! Posso ajudar com mais alguma coisa?"}]))}else l?(r(null),n(!1),i((e=>[...e,{role:"assistant",content:"Entendi. Quer tentar adicionar a tarefa novamente com informações diferentes?"}]))):i((e=>[...e,{role:"assistant",content:"Desculpe, não entendi. Você confirma a criação desta tarefa? Por favor, responda com 'sim' ou 'não'."}]))}}},pe={oi:"Olá! Como posso ajudar você hoje?","olá":"Olá! Como posso ajudar você hoje?",ola:"Olá! Como posso ajudar você hoje?","bom dia":"Bom dia! Como posso ajudar você hoje?","boa tarde":"Boa tarde! Como posso ajudar você hoje?","boa noite":"Boa noite! Como posso ajudar você hoje?","quem é você":"Sou um assistente virtual que ajuda você a gerenciar sua agenda e tarefas. Posso adicionar eventos, reuniões e tarefas ao seu calendário.","o que você faz":"Eu ajudo você a gerenciar sua agenda. Posso criar eventos, tarefas, e ajudar você a se organizar melhor.","como você funciona":"Eu uso processamento de linguagem natural para entender seus pedidos e ajudar a gerenciar sua agenda. Basta me dizer o que precisa adicionar ao calendário.","como adicionar um evento":"Você pode dizer algo como 'Adicione uma reunião amanhã às 15h' ou 'Crie um evento para sexta-feira'. Também pode clicar no ícone de calendário para adicionar manualmente.",ajuda:"Posso ajudar você a gerenciar sua agenda. Experimente comandos como 'adicionar reunião', 'criar evento', ou 'agendar tarefa'. O que você precisa hoje?"},he=e=>{const a=e.toLowerCase().trim();if(pe[a])return pe[a];for(const[s,t]of Object.entries(pe))if(a.includes(s))return t;return null},ge={"quais meus próximos compromissos":"Vou verificar seus próximos compromissos para você.","o que tenho hoje":"Deixe-me verificar o que você tem agendado para hoje.","minha agenda":"Vou verificar sua agenda para você.","quais são minhas tarefas":"Deixe-me consultar suas tarefas pendentes.","tenho alguma reunião":"Vou verificar se você tem alguma reunião agendada.","compromissos de hoje":"Consultando seus compromissos para hoje.","agenda da semana":"Vou verificar sua agenda para esta semana."},fe=e=>{const a=e.toLowerCase();return["adicionar","criar","marcar","agendar","lembrar","lembrete para","evento","reunião","compromisso","tarefa","encontro","nova","novo","viagem","viajar","visitar","ir para","passear","excursão","passeio","férias","feriado","voo","embarque","hotel","hospedagem"].some((e=>a.includes(e)))},xe=(e,a,s,t=!0)=>{s.current+=1;const r=e.toLowerCase();if(r.includes("almoço")||r.includes("jantar")||r.includes("café")||fe(e)){const s=me(e);if(s&&s.title)return void a((e=>[...e,{role:"assistant",content:"Estou offline no momento, mas posso ajudar a adicionar esse compromisso básico. Por favor, confirme os detalhes:",shouldSpeak:t}]))}const o=he(e);if(o)return void a((e=>[...e,{role:"assistant",content:o,shouldSpeak:t}]));const n=(()=>{const e=Math.floor(Math.random()*de.length);return de[e]})();a((e=>[...e,{role:"assistant",content:n,shouldSpeak:t}]))},ve=(e,a,s,t,r,o=!0)=>{const n=`Confirmando: ${e.title||"Novo compromisso"}${e.date?` para ${e.date}`:""}${e.time?` às ${e.time}`:""}${e.location?` em ${e.location}`:""}. Confirma?`;a((e=>[...e,{role:"assistant",content:n,shouldSpeak:o}])),s(e),t(!0)},ye="assistant_memory",be=async()=>{try{const e=localStorage.getItem(ye);if(!e){const e={recentInteractions:[],userPreferences:{},userBehaviorPatterns:{preferredTimes:{},frequentLocations:[],frequentCancellations:[],productiveHours:[],taskCompletionRate:{},preferredMeetingDuration:60},lastInteractionDate:(new Date).toISOString()};return localStorage.setItem(ye,JSON.stringify(e)),e}return JSON.parse(e)}catch(e){return{recentInteractions:[],userPreferences:{},userBehaviorPatterns:{preferredTimes:{},frequentLocations:[],frequentCancellations:[],productiveHours:[],taskCompletionRate:{},preferredMeetingDuration:60},lastInteractionDate:(new Date).toISOString()}}},je=async(e,a)=>{try{const s=await be(),t=[...s.recentInteractions,...e].slice(-20);let r={...s.userBehaviorPatterns};a&&a.length>0&&(r=we(a,r));const o={...s,recentInteractions:t,userBehaviorPatterns:r,lastInteractionDate:(new Date).toISOString()};return localStorage.setItem(ye,JSON.stringify(o)),!0}catch(s){return!1}},we=(e,a)=>{const s={...a},t={};return e.forEach((e=>{if(e.type&&e.start_time&&(t[e.type]||(t[e.type]=[]),t[e.type].includes(e.start_time)||t[e.type].push(e.start_time)),e.location&&!s.frequentLocations.includes(e.location)&&(s.frequentLocations.push(e.location),s.frequentLocations.length>10&&(s.frequentLocations=s.frequentLocations.slice(-10))),e.type)if(s.taskCompletionRate[e.type]||(s.taskCompletionRate[e.type]=.5),e.completed)s.taskCompletionRate[e.type]+=.1,s.taskCompletionRate[e.type]=Math.min(s.taskCompletionRate[e.type],1);else{const a=new Date(e.scheduled_date);if(a<new Date&&!e.completed){s.taskCompletionRate[e.type]-=.1,s.taskCompletionRate[e.type]=Math.max(s.taskCompletionRate[e.type],0);const t=a.getDay(),r=e.start_time?Ne(e.start_time):"all-day";s.frequentCancellations.find((e=>e.dayOfWeek===t&&e.timeRange===r))||(s.frequentCancellations.push({dayOfWeek:t,timeRange:r}),s.frequentCancellations.length>5&&(s.frequentCancellations=s.frequentCancellations.slice(-5)))}}})),s.preferredTimes={...s.preferredTimes,...t},s},Ne=e=>{const a=parseInt(e.split(":")[0],10);return a>=5&&a<12?"morning":a>=12&&a<14?"lunch":a>=14&&a<18?"afternoon":a>=18&&a<22?"evening":"night"},Se=e=>["domingo","segunda-feira","terça-feira","quarta-feira","quinta-feira","sexta-feira","sábado"][e],ke=e=>{switch(e){case"morning":return"manhã";case"lunch":return"almoço";case"afternoon":return"tarde";case"evening":return"noite";case"night":return"madrugada";default:return"dia todo"}},Te=async(e,a)=>{try{const{data:{user:s}}=await C.auth.getUser();if(!s)return{success:!1,message:"Você precisa estar logado para reagendar tarefas."};const t=a.find((a=>a.id===e.taskId));if(!t)return{success:!1,message:"Tarefa não encontrada."};const r={};e.newDate&&(r.scheduled_date=e.newDate),e.newTime&&(r.start_time=e.newTime);const o={...t,...r},n=await(async(e,a)=>{const s=[];if(!e.scheduled_date)return s;const t=a.filter((a=>a.id!==e.id&&a.scheduled_date===e.scheduled_date));if(e.start_time&&e.duration){const a=_e(e.start_time),r=a+parseInt(e.duration);t.forEach((t=>{if(t.start_time&&t.duration){const o=_e(t.start_time),n=o+parseInt(t.duration);a<=n&&r>=o||o<=r&&n>=a?s.push({taskId:e.id,conflictingTaskId:t.id,conflictType:"overlap",severity:"high",suggestion:`Este compromisso se sobrepõe a "${t.title}" das ${t.start_time} às ${Ie(n)}.`}):(Math.abs(r-o)<30||Math.abs(n-a)<30)&&s.push({taskId:e.id,conflictingTaskId:t.id,conflictType:"proximity",severity:"medium",suggestion:`Este compromisso está muito próximo de "${t.title}". Considere adicionar mais tempo entre eles.`})}}))}if(e.location&&e.start_time&&e.duration){const a=_e(e.start_time)+parseInt(e.duration);t.forEach((t=>{if(t.location&&t.location!==e.location&&t.start_time){const r=_e(t.start_time);Math.abs(a-r)<60&&s.push({taskId:e.id,conflictingTaskId:t.id,conflictType:"location",severity:"medium",suggestion:`Você tem pouco tempo para se deslocar de "${e.location}" para "${t.location}". Considere reagendar ou adicionar mais tempo entre os compromissos.`})}}))}return s})(o,a);if(n.length>0)return{success:!1,message:"Existem conflitos com o novo horário. Deseja continuar mesmo assim?",conflicts:n};const{error:i}=await C.from("tasks").update(r).eq("id",e.taskId).eq("user_id",s.id);return i?{success:!1,message:"Ocorreu um erro ao reagendar a tarefa. Por favor, tente novamente."}:{success:!0,message:`Tarefa reagendada com sucesso para ${e.newDate||t.scheduled_date}${e.newTime?` às ${e.newTime}`:""}.`}}catch(s){return{success:!1,message:"Ocorreu um erro ao reagendar a tarefa. Por favor, tente novamente."}}},Ce=async e=>{try{const a=await(async e=>{try{const a=await be(),s=[],t=a.userBehaviorPatterns;e.filter((e=>{const a=(new Date).toISOString().split("T")[0];return e.scheduled_date===a})).length>8&&s.push("Sua agenda para hoje está muito cheia. Considere mover algumas tarefas para outro dia."),e.forEach((e=>{if(e.type&&t.taskCompletionRate[e.type]<.3&&s.push(`Você tem um histórico baixo de conclusão para tarefas do tipo "${e.type}". Considere alocar mais tempo ou reagendar para um horário mais produtivo.`),e.scheduled_date){const a=new Date(e.scheduled_date).getDay(),r=e.start_time?Ne(e.start_time):"all-day";t.frequentCancellations.some((e=>e.dayOfWeek===a&&e.timeRange===r))&&s.push(`Você costuma cancelar compromissos ${Se(a)} no período da ${ke(r)}. Deseja reagendar para outro momento?`)}}));const r={};return e.forEach((e=>{e.location&&(r[e.location]||(r[e.location]=[]),r[e.location].push(e))})),Object.entries(r).forEach((([e,a])=>{a.length>=2&&[...new Set(a.map((e=>e.scheduled_date)))].length>=2&&s.push(`Você tem ${a.length} compromissos em "${e}" espalhados em diferentes dias. Considere agrupá-los no mesmo dia para otimizar seu tempo.`)})),s}catch(a){return[]}})(e),s=[],t={};e.forEach((e=>{e.type&&(t[e.type]||(t[e.type]=[]),t[e.type].push(e))})),Object.entries(t).forEach((([e,a])=>{if(a.length>=3){[...new Set(a.map((e=>e.scheduled_date)))].length>=3&&s.push(`Você tem ${a.length} tarefas do tipo "${e}" espalhadas em diferentes dias. Considere agrupá-las para maior produtividade.`)}}));const r={};e.forEach((e=>{r[e.scheduled_date]||(r[e.scheduled_date]=[]),r[e.scheduled_date].push(e)}));const o=[],n=[];if(Object.entries(r).forEach((([e,a])=>{a.length>8?o.push(e):a.length<2&&n.push(e)})),o.length>0&&n.length>0){const e=$e(o[0]),a=$e(n[0]);s.push(`Você tem muitas tarefas em ${e} (${r[o[0]].length}) e poucas em ${a} (${r[n[0]].length}). Considere redistribuir algumas tarefas.`)}return[...a,...s]}catch(a){return[]}},_e=e=>{const[a,s]=e.split(":").map(Number);return 60*a+s},Ie=e=>{const a=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},$e=e=>new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),qe=e=>{const a={},s=[{pattern:/hoje/i,handler:()=>(new Date).toISOString().split("T")[0]},{pattern:/amanh[ãa]/i,handler:()=>{const e=new Date;return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]}},{pattern:/depois de amanh[ãa]/i,handler:()=>{const e=new Date;return e.setDate(e.getDate()+2),e.toISOString().split("T")[0]}},{pattern:/segunda[- ]feira|segunda/i,handler:()=>Pe(1).toISOString().split("T")[0]},{pattern:/ter[çc]a[- ]feira|ter[çc]a/i,handler:()=>Pe(2).toISOString().split("T")[0]},{pattern:/quarta[- ]feira|quarta/i,handler:()=>Pe(3).toISOString().split("T")[0]},{pattern:/quinta[- ]feira|quinta/i,handler:()=>Pe(4).toISOString().split("T")[0]},{pattern:/sexta[- ]feira|sexta/i,handler:()=>Pe(5).toISOString().split("T")[0]},{pattern:/s[áa]bado/i,handler:()=>Pe(6).toISOString().split("T")[0]},{pattern:/domingo/i,handler:()=>Pe(0).toISOString().split("T")[0]}];for(const{pattern:o,handler:n}of s)if(o.test(e)){a.date=n();break}const t=e.match(/(\d{1,2})[\/\-\.](\d{1,2})(?:[\/\-\.](\d{2,4}))?/);if(t){const e=parseInt(t[1],10),s=parseInt(t[2],10)-1,r=t[3]?parseInt(t[3],10):(new Date).getFullYear(),o=new Date(r<100?2e3+r:r,s,e);a.date=o.toISOString().split("T")[0]}const r=e.match(/(\d{1,2})[:\.](\d{2})(?:\s*(?:horas?|h))?|\b(\d{1,2})\s*(?:horas?|h)\b|meio[\s-]dia|meia[\s-]noite/i);if(r)if(r[0].match(/meio[\s-]dia/i))a.time="12:00";else if(r[0].match(/meia[\s-]noite/i))a.time="00:00";else if(r[3]){const e=parseInt(r[3],10);a.time=`${e.toString().padStart(2,"0")}:00`}else{const e=parseInt(r[1],10),s=parseInt(r[2],10);a.time=`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}return a},De=e=>{let a=e.replace(/^(criar|adicionar|agendar|marcar|novo|nova)\s+/i,"").replace(/^(compromisso|tarefa|evento|reuni[ãa]o|encontro|lembrete)\s+/i,"").replace(/\s+(para|em|no|na|às|as|ao|dia)\s+.+$/i,"");if(a.length<5){const s=e.split(/\s+/);a=s.slice(0,Math.min(5,s.length)).join(" ")}return a.trim()},Ae=e=>{const a=e.match(/\bem\s+([^,\.;]+)|\bno\s+([^,\.;]+)|\bna\s+([^,\.;]+)/i);if(a)return(a[1]||a[2]||a[3]).trim()},Pe=e=>{const a=new Date,s=new Date(a);return s.setDate(a.getDate()+(e-a.getDay()+7)%7),a.getDay()===e&&s.setDate(s.getDate()+7),s},Ee=async(e,a)=>{var s,t,r,o,n,i,c;try{switch(e.type){case"reschedule":{let r=[];if(e.taskIds&&e.taskIds.length>0)r=a.filter((a=>{var s;return null==(s=e.taskIds)?void 0:s.includes(a.id)}));else{const s=Oe(e.originalText);if(s.length>0&&(r=Re(a,s)),0===r.length){const e=[...a].sort(((e,a)=>new Date(a.created_at).getTime()-new Date(e.created_at).getTime()));e.length>0&&(r=[e[0]])}}if(0===r.length)return{success:!1,message:"Não encontrei nenhuma tarefa para reagendar. Poderia especificar qual tarefa deseja modificar?"};const o=r[0],n={taskId:o.id,newDate:null==(s=e.parameters)?void 0:s.date,newTime:null==(t=e.parameters)?void 0:t.time},i=await Te(n,a);return{success:i.success,message:i.message,data:{task:o,conflicts:i.conflicts}}}case"create":{const{data:{user:a}}=await C.auth.getUser();if(!a)return{success:!1,message:"Você precisa estar logado para criar tarefas."};const s={user_id:a.id,title:(null==(r=e.parameters)?void 0:r.title)||"Nova tarefa",scheduled_date:(null==(o=e.parameters)?void 0:o.date)||(new Date).toISOString().split("T")[0],start_time:(null==(n=e.parameters)?void 0:n.time)||null,location:(null==(i=e.parameters)?void 0:i.location)||null,completed:!1,type:"task",created_at:(new Date).toISOString()},{data:t,error:c}=await C.from("tasks").insert(s).select().single();return c?{success:!1,message:"Ocorreu um erro ao criar a tarefa. Por favor, tente novamente."}:{success:!0,message:`Tarefa "${s.title}" criada com sucesso para ${Me(s.scheduled_date)}${s.start_time?` às ${s.start_time}`:""}.`,data:{task:t}}}case"delete":{let s=[];if(e.taskIds&&e.taskIds.length>0)s=a.filter((a=>{var s;return null==(s=e.taskIds)?void 0:s.includes(a.id)}));else{const t=Oe(e.originalText);t.length>0&&(s=Re(a,t))}if(0===s.length)return{success:!1,message:"Não encontrei nenhuma tarefa para remover. Poderia especificar qual tarefa deseja excluir?"};const t=s[0],{data:{user:r}}=await C.auth.getUser();if(!r)return{success:!1,message:"Você precisa estar logado para excluir tarefas."};const{error:o}=await C.from("tasks").delete().eq("id",t.id).eq("user_id",r.id);return o?{success:!1,message:"Ocorreu um erro ao excluir a tarefa. Por favor, tente novamente."}:{success:!0,message:`Tarefa "${t.title}" removida com sucesso.`,data:{task:t}}}case"query":{let s=[...a];if(null==(c=e.parameters)?void 0:c.date)s=s.filter((a=>{var s;return a.scheduled_date===(null==(s=e.parameters)?void 0:s.date)}));else if(e.originalText.includes("hoje")){const e=(new Date).toISOString().split("T")[0];s=s.filter((a=>a.scheduled_date===e))}else if(e.originalText.includes("amanhã")){const e=new Date;e.setDate(e.getDate()+1);const a=e.toISOString().split("T")[0];s=s.filter((e=>e.scheduled_date===a))}else if(e.originalText.includes("semana")){const e=new Date,a=new Date;a.setDate(e.getDate()+7),s=s.filter((s=>{const t=new Date(s.scheduled_date);return t>=e&&t<=a}))}s.sort(((e,a)=>e.scheduled_date!==a.scheduled_date?e.scheduled_date.localeCompare(a.scheduled_date):e.start_time?a.start_time?e.start_time.localeCompare(a.start_time):-1:1));let t="";if(0===s.length)t="Você não tem compromissos agendados para esse período.";else if(1===s.length){const e=s[0];t=`Você tem 1 compromisso: ${e.title}, ${Me(e.scheduled_date)}${e.start_time?` às ${e.start_time}`:""}.`}else{t=`Você tem ${s.length} compromissos. Aqui estão os próximos: `;t+=s.slice(0,3).map((e=>`${e.title}, ${Me(e.scheduled_date)}${e.start_time?` às ${e.start_time}`:""}`)).join("; "),s.length>3&&(t+=` e mais ${s.length-3} outros.`)}return{success:!0,message:t,data:{tasks:s}}}case"optimize":{const s=e.taskIds&&e.taskIds.length>0?a.find((a=>a.id===e.taskIds[0])):void 0;if(s){const e=await(async(e,a,s)=>{try{const t=new Date,r=new Date;r.setDate(t.getDate()+7);const o=t.toISOString().split("T")[0],n=r.toISOString().split("T")[0],i=a.filter((e=>e.scheduled_date>=o&&e.scheduled_date<=n)),c={};i.forEach((e=>{c[e.scheduled_date]||(c[e.scheduled_date]=[]),c[e.scheduled_date].push(e)}));const l=(null==s?void 0:s.start)||"09:00",d=(null==s?void 0:s.end)||"18:00",m=_e(l),u=_e(d),p=e.duration?parseInt(e.duration):60;for(let e=0;e<7;e++){const a=new Date(t);a.setDate(t.getDate()+e);const s=a.toISOString().split("T")[0],r=c[s]||[];r.sort(((e,a)=>e.start_time?a.start_time?_e(e.start_time)-_e(a.start_time):1:-1));const o=[];r.forEach((e=>{if(e.start_time){const a=_e(e.start_time),s=a+(e.duration?parseInt(e.duration):60);o.push({start:a,end:s})}}));const n=[];if(o.length>0){o.sort(((e,a)=>e.start-a.start));let e={...o[0]};for(let a=1;a<o.length;a++)o[a].start<=e.end?e.end=Math.max(e.end,o[a].end):(n.push(e),e={...o[a]});n.push(e)}const i=[];if(0===n.length)i.push({start:m,end:u});else{n[0].start>m&&i.push({start:m,end:n[0].start});for(let e=0;e<n.length-1;e++)n[e+1].start-n[e].end>=p&&i.push({start:n[e].end,end:n[e+1].start});n[n.length-1].end<u&&i.push({start:n[n.length-1].end,end:u})}const l=i.filter((e=>e.end-e.start>=p));if(l.length>0)return{date:s,time:Ie(l[0].start)}}return null}catch(t){return null}})(s,a);return e?{success:!0,message:`Encontrei um horário ideal para "${s.title}": ${Me(e.date)} às ${e.time}. Deseja reagendar?`,data:{task:s,optimalSlot:e}}:{success:!1,message:"Não encontrei um horário ideal para essa tarefa nos próximos 7 dias."}}return{success:!0,message:"Aqui estão algumas sugestões para otimizar sua agenda:",data:{suggestions:["Considere agrupar tarefas semelhantes no mesmo dia para maior produtividade.","Tente deixar intervalos de pelo menos 15 minutos entre compromissos.","Reserve blocos de tempo específicos para tarefas que exigem foco."]}}}default:return{success:!1,message:"Não entendi o que você quer fazer. Poderia reformular seu pedido?"}}}catch(l){return{success:!1,message:"Ocorreu um erro ao processar seu comando. Por favor, tente novamente."}}},Oe=e=>e.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter((e=>e.length>3&&!["para","com","que","uma","este","esta","esse","essa","aquele","aquela","meu","minha","seu","sua"].includes(e))),Re=(e,a)=>e.filter((e=>{const s=`${e.title} ${e.details||""}`.toLowerCase();return a.some((e=>s.includes(e)))})),Me=e=>new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),ze=async({text:e,setIsProcessing:a,setIsOffline:s,connectionAttempts:t,lastUserMessageRef:r,setMessages:o,setPendingTaskConfirmation:n,setAwaitingConfirmation:i,awaitingConfirmation:c,pendingTaskConfirmation:l,handleConfirmationResponse:d,allTasks:m,refresh:u,shouldSpeak:p=!0})=>{try{a(!0);const r={role:"user",content:e};if(c&&l)return await d(e),void a(!1);const g=he(e);if(g){const e={role:"assistant",content:g,shouldSpeak:p};return o((a=>[...a,e])),await je([r,e],m),void a(!1)}if(!(await(async()=>{try{const a=new AbortController,s=setTimeout((()=>a.abort()),5e3);try{const e=await fetch("https://www.google.com",{method:"GET",signal:a.signal,mode:"no-cors"}).catch((()=>null));return clearTimeout(s),!!e}catch(e){return!1}}catch(e){return!1}})())){if(s(!0),fe(e)){const s=me(e);if(s&&s.title)return((e,a,s,t,r,o,n=!0)=>{t((e=>[...e,{role:"assistant",content:"Estou offline no momento, mas posso ajudar a adicionar esse compromisso básico. Por favor, confirme os detalhes:",shouldSpeak:n}])),ve(a,t,r,o,0,n)})(0,s,0,o,n,i,p),void a(!1)}return xe(e,o,t,p),void a(!1)}const f=await(async e=>{try{return[]}catch(a){return e((e=>[...e,{role:"assistant",content:"Ocorreu um erro. Poderia tentar novamente?"}])),[]}})(o);try{const s=await(async(e,a=[])=>{try{try{const{data:s,error:t}=await C.functions.invoke("nlp-assistant",{body:{message:e,previousMessages:a,mode:"command_extraction"}});if(!t&&s&&s.command)return s.command}catch(s){}const t={type:"unknown",originalText:e},r=[/mude|mover|transferir|reagendar|remarcar|adiar|postergar/i,/para (amanh[ãa]|depois|segunda|ter[çc]a|quarta|quinta|sexta|s[áa]bado|domingo)/i,/para o dia (\d{1,2})/i,/para [àa]s (\d{1,2})[:\.]?(\d{2})?/i];r.some((a=>a.test(e)))&&(t.type="reschedule",t.parameters=qe(e));const o=[/criar|adicionar|agendar|marcar|novo|nova/i,/compromisso|tarefa|evento|reuni[ãa]o|encontro|lembrete/i];return o.every((a=>a.test(e)))&&(t.type="create",t.parameters={...qe(e),title:De(e),location:Ae(e)}),[/remover|deletar|apagar|cancelar|excluir/i,/compromisso|tarefa|evento|reuni[ãa]o|encontro|lembrete/i].every((a=>a.test(e)))&&(t.type="delete"),![/mostrar|listar|ver|exibir|quais|quando|onde|que horas/i,/compromissos|tarefas|eventos|reuni[õo]es|encontros|lembretes|agenda/i,/hoje|amanh[ãa]|semana|m[êe]s/i].some((a=>a.test(e)))||o.some((a=>a.test(e)))||r.some((a=>a.test(e)))||(t.type="query",t.parameters=qe(e)),[/otimizar|melhorar|reorganizar|redistribuir|sugerir|sugest[õo]es/i,/agenda|compromissos|tarefas|tempo|dia/i].every((a=>a.test(e)))&&(t.type="optimize"),t}catch(t){return{type:"unknown",originalText:e}}})(e,f);if("unknown"!==s.type){const e=await Ee(s,m||[]),t={role:"assistant",content:e.message,shouldSpeak:p};if(o((e=>[...e,t])),await je([r,t],m),!e.success||"create"!==s.type&&"delete"!==s.type&&"reschedule"!==s.type||u(),e.success&&("query"===s.type||"optimize"===s.type)&&m&&m.length>0){const e=await Ce(m);if(e.length>0){const a=e[Math.floor(Math.random()*e.length)];setTimeout((()=>{const e={role:"assistant",content:`Dica: ${a}`,shouldSpeak:!1};o((a=>[...a,e])),je([e])}),3e3)}}return void a(!1)}if(fe(e)){const a=me(e);if(a&&a.title){ve(a,o,n,i,0,p);const e={role:"assistant",content:`Confirmando: ${a.title||"Novo compromisso"}${a.date?` para ${a.date}`:""}${a.time?` às ${a.time}`:""}${a.location?` em ${a.location}`:""}. Confirma?`,shouldSpeak:p};await je([r,e],m)}else{const e={role:"assistant",content:"Parece que você quer criar um evento, mas preciso de mais detalhes. Poderia fornecer informações como data, hora e local?",shouldSpeak:p};o((a=>[...a,e])),await je([r,e],m)}}else if((e=>{const a=e.toLowerCase().trim();for(const r of Object.keys(ge))if(a.includes(r))return!0;const s=["quais","quando","onde","que horas","horário","próximo","tenho","agenda","compromisso","mostrar","listar","ver","consultar","próximos","essa semana","hoje","amanhã","pendente"].some((e=>a.includes(e))),t=["adicionar","criar","marcar","agendar","novo","nova"].some((e=>a.includes(e)));return s&&!t})(e)){const a={type:"query",originalText:e,parameters:{}},s={role:"assistant",content:(await Ee(a,m||[])).message,shouldSpeak:p};o((e=>[...e,s])),await je([r,s],m)}else{const e={role:"assistant",content:"Não entendi completamente o que você quer fazer. Posso ajudar você a gerenciar sua agenda, criar tarefas, ou responder perguntas sobre seus compromissos. Como posso ajudar?",shouldSpeak:p};o((a=>[...a,e])),await je([r,e],m)}}catch(h){const e={role:"assistant",content:"Desculpe, não consegui processar sua solicitação completamente. Posso ajudar você a adicionar um compromisso ou responder perguntas básicas.",shouldSpeak:p};o((a=>[...a,e])),await je([r,e],m)}}catch(h){xe(e,o,t,p)}finally{a(!1)}};function Le(){const[a,s]=e.useState(!1),[t,r]=e.useState(!1),[o,i]=e.useState(!0),c=e.useRef(null),l=e.useRef(""),{refresh:d}=I(),{allTasks:m}=R(),{messages:u,setMessages:p,addUserMessage:h,isSpeaking:g,stopSpeech:f}=ce(),{isOffline:x,setIsOffline:v,isRetrying:y,connectionAttempts:b,handleRetryConnection:j}=(()=>{const[a,s]=e.useState(!1),[t,r]=e.useState(!1),o=e.useRef(0),{addAssistantMessage:n}=ce();return e.useEffect((()=>{(async()=>{const e=await le();s(!e)})();const e=setInterval((async()=>{a&&await le()&&(s(!1),o.current=0,n("Conexão restaurada! Como posso ajudar você agora?"))}),3e4);return()=>clearInterval(e)}),[a,n]),{isOffline:a,setIsOffline:s,isRetrying:t,setIsRetrying:r,connectionAttempts:o,handleRetryConnection:async()=>{r(!0);const e=await le();s(!e),e?(o.current=0,n("Conexão restaurada! Como posso ajudar você agora?")):n("Ainda estou com problemas de conexão. Você pode tentar novamente mais tarde ou adicionar eventos manualmente."),r(!1)}}})(),{pendingTaskConfirmation:w,setPendingTaskConfirmation:N,awaitingConfirmation:S,setAwaitingConfirmation:k,handleConfirmationResponse:T}=ue(r,d),C=async e=>{await ze({text:e,setIsProcessing:r,setIsOffline:v,connectionAttempts:b,lastUserMessageRef:l,setMessages:p,setPendingTaskConfirmation:N,setAwaitingConfirmation:k,awaitingConfirmation:S,pendingTaskConfirmation:w,handleConfirmationResponse:T,allTasks:m,refresh:d,shouldSpeak:o})};return n.jsx("div",{className:"space-y-4",children:n.jsxs(M,{className:"overflow-hidden shadow-md border border-purple-100",children:[n.jsx(z,{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-4",children:n.jsx(ae,{isOffline:x,isSpeaking:g,onToggleSpeech:()=>{g&&f(),i(!o)}})}),n.jsxs(B,{className:"p-0",children:[x&&n.jsx(oe,{}),n.jsx(se,{messages:u}),x&&n.jsx(ne,{isRetrying:y,onRetry:j}),n.jsx(re,{isProcessing:t,isRecording:a,setIsRecording:s,onTranscription:e=>{l.current=e,h(e),C(e)},onSendClick:()=>{if(c.current&&c.current.value.trim()&&!t){const e=c.current.value.trim();l.current=e,c.current.value="",h(e),C(e)}},onTextInput:e=>{if("Enter"===e.key&&e.currentTarget.value.trim()&&!t){const a=e.currentTarget.value.trim();l.current=a,e.currentTarget.value="",h(a),C(a)}},inputRef:c})]})]})})}class Ve extends e.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,a){this.props.onError&&this.props.onError(e,a)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:n.jsxs("div",{className:"p-4 rounded-md bg-red-50 border border-red-200 text-red-800",children:[n.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Something went wrong"}),n.jsx("p",{className:"mb-4",children:"An error occurred while rendering this component. Please try refreshing the page."}),this.state.error&&n.jsxs("details",{className:"mt-2 text-sm",children:[n.jsx("summary",{className:"cursor-pointer font-medium",children:"Error details"}),n.jsx("pre",{className:"mt-2 p-2 bg-red-100 rounded overflow-auto text-xs",children:this.state.error.toString()})]}),n.jsx("button",{className:"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded-md transition-colors",onClick:()=>window.location.reload(),children:"Refresh page"})]}):this.props.children}}const Be=({size:e="md",className:a,variant:s="primary"})=>n.jsx("div",{className:E("inline-block animate-spin rounded-full",{sm:"h-4 w-4 border-2",md:"h-6 w-6 border-2",lg:"h-8 w-8 border-3",xl:"h-12 w-12 border-4"}[e],{default:"border-gray-300 border-t-gray-600",primary:"border-gray-300 border-t-primary",secondary:"border-gray-300 border-t-secondary",ghost:"border-gray-200 border-t-gray-400"}[s],a),role:"status","aria-label":"Loading",children:n.jsx("span",{className:"sr-only",children:"Loading..."})}),Fe=e.memo((({children:a,delay:s=100,showLoading:t=!0,fadeIn:r=!0,staggered:o=!0,priorityOrder:i,onComplete:c})=>{const[l,d]=e.useState(0),[m,u]=e.useState([]),p=e.useRef(null),h=e.useRef(Date.now()),g=x.Children.toArray(a),f=i||Array.from({length:g.length},((e,a)=>a));return e.useEffect((()=>{if(l>=g.length)return void(c&&c());const e=o?s*(0===l?1:.5*Math.log(l+1)):s;return p.current=setTimeout((()=>{const e=f[l];u((a=>[...a,e])),d((e=>e+1))}),e),()=>{p.current&&clearTimeout(p.current)}}),[l,g.length,s,o,f,c]),e.useEffect((()=>()=>{Date.now(),h.current}),[g.length]),n.jsxs(n.Fragment,{children:[g.map(((e,a)=>m.includes(a)?n.jsx("div",{className:r?"animate-fade-in":"",style:{animationDelay:r?50*a+"ms":"0ms"},children:e},`content-${a}`):t?n.jsx("div",{className:"animate-pulse bg-muted rounded-md w-full h-24 mb-4","aria-hidden":"true",children:a===f[l]&&n.jsx("div",{className:"flex items-center justify-center h-full",children:n.jsx(Be,{size:"sm"})})},`skeleton-${a}`):null)),l<g.length&&t&&n.jsxs("div",{className:"flex items-center justify-center py-4",children:[n.jsxs("div",{className:"text-sm text-muted-foreground mr-2",children:["Carregando ",l,"/",g.length]}),n.jsx(Be,{size:"sm"})]})]})}));const He=e.memo((function({items:a,itemHeight:s,renderItem:t,height:r,width:o="100%",overscan:i=3,className:c="",fadeEdges:l=!1,onItemVisible:d}){const m=e.useRef(null),[u,p]=e.useState(0),[h,g]=e.useState([]),f=e.useCallback((()=>{if(!m.current)return;const e=m.current.scrollTop;p(e);const t=Math.max(0,Math.floor(e/s)-i),o=Math.min(a.length-1,Math.ceil((e+r)/s)+i),n=[];for(let a=t;a<=o;a++)n.push(a);if(g(n),d){const t=Math.floor(e/s),o=Math.ceil((e+r)/s);for(let e=t;e<=o;e++)e>=0&&e<a.length&&d(e)}}),[r,s,a.length,d,i]),x=e.useCallback((()=>{requestAnimationFrame(f)}),[f]);return e.useEffect((()=>{const e=m.current;if(e)return f(),e.addEventListener("scroll",x),()=>{e.removeEventListener("scroll",x)}}),[f,x]),e.useEffect((()=>{f()}),[a,f]),n.jsxs("div",{ref:m,className:`overflow-y-auto relative ${c}`,style:{height:r,width:o},"data-testid":"virtualized-list",children:[n.jsx("div",{style:{height:a.length*s}}),h.map((e=>n.jsx("div",{style:{position:"absolute",top:e*s,height:s,width:"100%"},"data-index":e,children:t(a[e],e)},e))),l&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute top-0 left-0 right-0 h-8 pointer-events-none",style:{background:"linear-gradient(to bottom, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%)",opacity:u>10?1:0,transition:"opacity 0.2s ease",zIndex:1}}),n.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-8 pointer-events-none",style:{background:"linear-gradient(to top, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%)",opacity:u<a.length*s-r-10?1:0,transition:"opacity 0.2s ease",zIndex:1}})]})]})}));function Ue(){const[i,c]=e.useState(0),{refreshAssistant:l}=I(),{insights:d,progressSummary:m,areaSuggestions:u,habitRecommendations:p,refreshData:h,isLoading:g}=function(n=0){const[i,c]=e.useState([]),[l,d]=e.useState([]),[m,u]=e.useState([]),[p,h]=e.useState(!0),{areaProgress:g}=O(),{allTasks:f}=R(),[x,v]=e.useState({topAreaProgress:0,topAreaName:"",lowestAreaProgress:0,lowestAreaName:"",allAreasProgress:[],areasNeedingAttention:[],strengths:[],improvementAreas:[]}),y=e=>{switch(e){case"health":default:return a;case"business":return o;case"finances":return r;case"family":return t;case"spirituality":return s}},b=e=>{switch(e){case"health":return"bg-green-500";case"business":return"bg-blue-500";case"finances":return"bg-yellow-500";case"family":return"bg-pink-500";case"spirituality":return"bg-purple-500";default:return"bg-gray-500"}},j=e=>{switch(e){case"health":return"bg-green-50";case"business":return"bg-blue-50";case"finances":return"bg-yellow-50";case"family":return"bg-pink-50";case"spirituality":return"bg-purple-50";default:return"bg-gray-50"}},w=e=>{switch(e){case"health":return"border-green-200";case"business":return"border-blue-200";case"finances":return"border-yellow-200";case"family":return"border-pink-200";case"spirituality":return"border-purple-200";default:return"border-gray-200"}},N=e=>{switch(e){case"health":return"bg-gradient-to-r from-green-400 to-emerald-500";case"business":return"bg-gradient-to-r from-blue-400 to-indigo-500";case"finances":return"bg-gradient-to-r from-amber-400 to-yellow-500";case"family":return"bg-gradient-to-r from-pink-400 to-rose-500";case"spirituality":return"bg-gradient-to-r from-purple-400 to-violet-500";default:return"bg-gradient-to-r from-gray-400 to-gray-500"}},S=e.useCallback((async()=>{try{h(!0);const{data:{user:e}}=await C.auth.getUser();if(!e)return;await k(e.id),T(),I(),_(),h(!1)}catch(e){h(!1)}}),[g,f]);e.useEffect((()=>{S()}),[n,S]);const k=async e=>{try{const{data:a,error:s}=await C.from("daily_routines").select("*").eq("user_id",e).order("scheduled_date",{ascending:!1}).limit(20);if(s)throw s;const{data:t,error:r}=await C.from("mood_entries").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(7);if(r)throw r;let o=0,n=0,i=0,l=0,d=0;a&&a.length>0&&(o=a.filter((e=>e.completed)).length/a.length*100,n=a.filter((e=>"health"===e.category)).length,i=a.filter((e=>"health"===e.category&&e.completed)).length,l=a.filter((e=>"business"===e.category)).length,d=a.filter((e=>"business"===e.category&&e.completed)).length);const m=[];if(a&&a.length>0&&(o>=70?m.push({type:"progress",title:"Alta taxa de conclusão de tarefas",description:`Você concluiu ${Math.round(o)}% das suas tarefas recentes. Continue com o bom trabalho!`,area:"Geral",action:"Mantenha esse ritmo e considere aumentar gradualmente seus desafios."}):o<40&&m.push({type:"warning",title:"Queda na conclusão de tarefas",description:`Sua taxa de conclusão está em ${Math.round(o)}%, o que é abaixo do ideal.`,area:"Geral",action:"Tente reduzir o número de tarefas diárias para torná-las mais gerenciáveis."})),n>0){const e=i/n*100;e>=80?m.push({type:"achievement",title:"Excelente em hábitos de saúde",description:`Você concluiu ${Math.round(e)}% dos seus hábitos de saúde recentemente.`,area:"Saúde",action:"Continue com esses hábitos saudáveis e considere adicionar novos desafios."}):e<=30&&n>=3&&m.push({type:"decline",title:"Hábitos de saúde em queda",description:"Você tem completado poucos hábitos relacionados à saúde ultimamente.",area:"Saúde",action:"Tente retomar um hábito de saúde de cada vez, começando com o mais simples."})}if(l>0){const e=d/l*100;e>=75&&m.push({type:"progress",title:"Produtividade no trabalho",description:`Você está sendo muito produtivo na área profissional, completando ${Math.round(e)}% das tarefas.`,area:"Carreira"})}const u=(null==a?void 0:a.filter((e=>e.streak_count&&e.streak_count>=7)))||[];if(u.length>0){const e=u.sort(((e,a)=>(a.streak_count||0)-(e.streak_count||0)))[0];m.push({type:"consistency",title:"Consistência identificada",description:`Você manteve "${e.title}" por ${e.streak_count} dias consecutivos!`,area:"health"===e.category?"Saúde":"business"===e.category?"Carreira":"finances"===e.category?"Finanças":"family"===e.category?"Família":"Espiritualidade",action:"A consistência é fundamental para a formação de hábitos. Continue assim!"})}t&&t.length>=3&&t.filter((e=>"happy"===e.mood_type||"excited"===e.mood_type||"content"===e.mood_type)).length>=2&&m.push({type:"progress",title:"Padrão de humor positivo",description:"Você tem registrado mais emoções positivas nos últimos dias.",area:"Bem-estar",action:"Continue praticando atividades que melhoram seu humor."}),c(m.slice(0,3))}catch(a){c([{type:"general",title:"Bem-vindo ao seu assistente IA",description:"Estou analisando seus dados para gerar insights personalizados.",area:"Geral",action:"Continue adicionando tarefas e hábitos para melhorar a precisão das recomendações."}])}},T=()=>{const e=g.map((e=>{const a=f.filter((a=>a.category===e.areaType)),s=a.filter((e=>e.completed)).length,t=a.filter((e=>!e.completed)).length;return{name:e.area,areaType:e.areaType,progress:e.progress,tasks_completed:s,tasks_pending:t,color:b(e.areaType),gradient:N(e.areaType)}})),a=[...e].sort(((e,a)=>a.progress-e.progress)),s=a[0]||{name:"N/A",progress:0},t=a[a.length-1]||{name:"N/A",progress:0},r=e.filter((e=>e.progress<30||e.tasks_pending>2*e.tasks_completed)).map((e=>({name:e.name,reason:e.progress<30?`Progresso baixo (${e.progress}%)`:`${e.tasks_pending} tarefas pendentes`,color:b(e.areaType),icon:y(e.areaType)}))),o=a.filter((e=>e.progress>=50)).map((e=>`${e.name}: ${e.progress}% de progresso`)),n=a.filter((e=>e.progress<50)).map((e=>`${e.name}: precisa de mais foco (${e.progress}%)`));v({topAreaProgress:s.progress,topAreaName:s.name,lowestAreaProgress:t.progress,lowestAreaName:t.name,allAreasProgress:e,areasNeedingAttention:r,strengths:o,improvementAreas:n})},_=()=>{const e=[...g].sort(((e,a)=>e.progress-a.progress)).slice(0,2).map((e=>{let a=[];switch(e.areaType){case"health":a=["Meditação por 10 minutos diários","Beber 2L de água por dia","Dormir 8 horas por noite"];break;case"business":a=["Leitura profissional por 15min diários","Fazer networking semanal","Definir 3 prioridades por dia"];break;case"finances":a=["Revisar gastos semanalmente","Planejar investimentos mensais","Eliminar uma despesa desnecessária"];break;case"family":a=["Tempo de qualidade em família","Ligar para um amigo por semana","Organizar um encontro mensal"];break;case"spirituality":a=["Praticar gratidão diariamente","Tempo na natureza semanalmente","Definir propósito pessoal"]}return{areaType:e.areaType,title:`Melhore sua área de ${e.area}`,description:`Sugestões para aumentar seu progresso em ${e.area}:`,items:a,color:b(e.areaType),bgColor:j(e.areaType),borderColor:w(e.areaType)}}));d(e)},I=()=>{const e=[...g].sort(((e,a)=>e.progress-a.progress)).slice(0,3),a=[];e.forEach((e=>{let s=[];switch(e.areaType){case"health":s=[{title:"Exercício Físico Matinal",description:"Comece o dia com 20 minutos de exercícios para aumentar energia e foco.",frequency:"3-5x por semana"},{title:"Hidratação Constante",description:"Beba 2L de água diariamente para melhorar digestão e foco mental.",frequency:"Diariamente"}];break;case"business":s=[{title:"Planejamento Semanal",description:"Dedique 30 minutos no domingo para planejar sua semana profissional.",frequency:"1x por semana"},{title:"Desenvolvimento de Habilidades",description:"Invista 20 minutos diários em aprender novas habilidades profissionais.",frequency:"Dias úteis"}];break;case"finances":s=[{title:"Revisão de Orçamento",description:"Analise seus gastos e planeje seu orçamento para a próxima semana.",frequency:"1x por semana"},{title:"Educação Financeira",description:"Dedique tempo para aprender sobre investimentos e finanças pessoais.",frequency:"2x por semana"}];break;case"family":s=[{title:"Tempo de Qualidade em Família",description:"Reserve tempo exclusivo para atividades com pessoas queridas, sem distrações.",frequency:"2-3x por semana"},{title:"Ligação para Amigos",description:"Mantenha contato com amigos importantes para fortalecer relacionamentos.",frequency:"1x por semana"}];break;case"spirituality":s=[{title:"Meditação Matinal",description:"Pratique 10 minutos de meditação pela manhã para clareza mental.",frequency:"Diariamente"},{title:"Diário de Gratidão",description:"Anote 3 coisas pelas quais você é grato todos os dias antes de dormir.",frequency:"Diariamente"}]}s.forEach((s=>{a.push({...s,areaType:e.areaType,areaName:e.area,areaColor:b(e.areaType),areaIcon:y(e.areaType)})}))}));const s=a.sort((()=>.5-Math.random()));u(s.slice(0,4))};return{insights:i,areaSuggestions:l,progressSummary:x,habitRecommendations:m,isLoading:p,refreshData:S}}(),f=e.useCallback((()=>{c((e=>e+1)),l()}),[l]);e.useEffect((()=>{const e=setTimeout((()=>{h()}),100);return()=>clearTimeout(e)}),[i,h]);const x=e.useMemo((()=>n.jsx(He,{items:d,itemHeight:80,height:400,renderItem:e=>n.jsx(X,{insights:[e]})})),[d]),v=e.useMemo((()=>n.jsx(Y,{data:m})),[m]),y=e.useMemo((()=>n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:p&&p.length>0?p.map(((e,a)=>n.jsx(ee,{recommendation:e,onRefresh:f},`habit-${a}`))):n.jsx("div",{className:"text-center text-gray-500",children:"Ainda não temos recomendações de hábitos para você."})})),[p,f]),b=e.useMemo((()=>u&&u.length>0?n.jsx("div",{className:"container max-w-7xl mx-auto px-4 mt-6",children:n.jsx(Z,{recommendations:u})}):null),[u]);return n.jsx(Ve,{children:n.jsxs(Fe,{showLoading:g,children:[n.jsx("div",{className:"container max-w-7xl mx-auto p-4 pb-safe",children:n.jsx(K,{})}),n.jsx("div",{className:"container max-w-7xl mx-auto px-4 mb-6",children:n.jsx(Le,{})}),g?n.jsxs("div",{className:"container max-w-7xl mx-auto px-4 space-y-4",children:[n.jsx(J,{className:"h-64 w-full rounded-xl"}),n.jsx(J,{className:"h-64 w-full rounded-xl"})]}):n.jsx("div",{className:"container max-w-7xl mx-auto px-4",children:n.jsxs(F,{defaultValue:"insights",children:[n.jsxs(H,{className:"grid grid-cols-3 mb-4",children:[n.jsx(U,{value:"insights",children:"Insights"}),n.jsx(U,{value:"stats",children:"Progresso"}),n.jsx(U,{value:"habits",children:"Hábitos"})]}),n.jsx(G,{value:"insights",children:x}),n.jsx(G,{value:"stats",children:v}),n.jsx(G,{value:"habits",children:y})]})}),b]})})}export{Ue as default};

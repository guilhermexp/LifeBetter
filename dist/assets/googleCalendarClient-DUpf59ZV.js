import{s as t}from"./index-QnHMPHoX.js";const e="https://tjauuyydxagnugqvmigm.supabase.co/functions/v1/google-calendar-auth",r=async()=>{try{const t=window.location.origin+"/settings?tab=interacoes",r=`${e}/authorize?redirect=${encodeURIComponent(t)}`;window.location.href=r}catch(t){throw t}},a=async(r,a)=>{try{const{data:{session:o}}=await t.auth.getSession();if(!o)throw new Error("User not authenticated");const n=`${e}/events`,s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.access_token}`},body:JSON.stringify({startDate:r,endDate:a})});if(!s.ok){const t=await s.json();throw new Error(t.error||"Failed to fetch events")}return(await s.json()).events}catch(o){throw o}},o=async()=>{try{const{data:{user:e}}=await t.auth.getUser();if(!e)return{connected:!1};const{data:r,error:a}=await t.from("google_calendar_integration").select("*").eq("user_id",e.id).single();if(a&&"PGRST116"!==a.code)throw a;return{connected:!!r,integration:r}}catch(e){throw e}},n=async e=>{try{const{data:{user:r}}=await t.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:a,error:o}=await t.from("google_calendar_preferences").upsert({user_id:r.id,...e}).select().single();if(o)throw o;return a}catch(r){throw r}},s=async()=>{try{const{data:{user:e}}=await t.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:r,error:a}=await t.from("google_calendar_preferences").select("*").eq("user_id",e.id).single();if(a&&"PGRST116"!==a.code)throw a;return r||{import_meetings:!0,import_personal:!0,import_all:!0}}catch(e){throw e}},i=async()=>{try{const{data:{user:e}}=await t.auth.getUser();if(!e)throw new Error("User not authenticated");const{error:r}=await t.from("google_calendar_integration").delete().eq("user_id",e.id);if(r)throw r;return{success:!0}}catch(e){throw e}};export{o as c,i as d,a as f,s as g,r as i,n as s};
